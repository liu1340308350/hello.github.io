<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="[TOC]">
<meta property="og:type" content="article">
<meta property="og:title" content="o2o校园商铺系统">
<meta property="og:url" content="http://yoursite.com/2019/03/23/o2o%E6%A0%A1%E5%9B%AD%E5%95%86%E9%93%BA%E7%B3%BB%E7%BB%9F/index.html">
<meta property="og:site_name" content="lb Blog">
<meta property="og:description" content="[TOC]">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="c:%5CUsers%5Cadmin%5CDesktop%5Cblog%5Csource%5Cimages%5C2019032301.png">
<meta property="og:image" content="c:%5CUsers%5Cadmin%5CDesktop%5Cblog%5Csource%5Cimages%5C2019032302.png">
<meta property="article:published_time" content="2019-03-23T02:35:23.000Z">
<meta property="article:modified_time" content="2021-05-31T13:05:23.729Z">
<meta property="article:author" content="liubin">
<meta property="article:tag" content="校园商铺系统">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="c:%5CUsers%5Cadmin%5CDesktop%5Cblog%5Csource%5Cimages%5C2019032301.png">

<link rel="canonical" href="http://yoursite.com/2019/03/23/o2o%E6%A0%A1%E5%9B%AD%E5%95%86%E9%93%BA%E7%B3%BB%E7%BB%9F/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>o2o校园商铺系统 | lb Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">lb Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/23/o2o%E6%A0%A1%E5%9B%AD%E5%95%86%E9%93%BA%E7%B3%BB%E7%BB%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="liubin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lb Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          o2o校园商铺系统
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-23 10:35:23" itemprop="dateCreated datePublished" datetime="2019-03-23T10:35:23+08:00">2019-03-23</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">项目开发</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>[TOC]</p>
<a id="more"></a>

<h1 id="1-开发准备"><a href="#1-开发准备" class="headerlink" title="1 开发准备"></a>1 开发准备</h1><h1 id="2-项目设计和框架搭建"><a href="#2-项目设计和框架搭建" class="headerlink" title="2 项目设计和框架搭建"></a>2 项目设计和框架搭建</h1><h2 id="2-1-系统功能模块划分"><a href="#2-1-系统功能模块划分" class="headerlink" title="2-1 系统功能模块划分"></a>2-1 系统功能模块划分</h2><p>系统可以划分为3个系统</p>
<ul>
<li>前端展示系统<ul>
<li>头条展示</li>
<li>店铺类别展示</li>
<li>店铺<ul>
<li>列表展示</li>
<li>查询</li>
<li>详情</li>
</ul>
</li>
<li>商品<ul>
<li>列表展示</li>
<li>查询</li>
<li>详情</li>
</ul>
</li>
</ul>
</li>
<li>店家系统<ul>
<li>Local账户维护</li>
<li>微信账户维护</li>
<li>店铺信息维护</li>
<li>权限验证</li>
<li>商品类别维护</li>
</ul>
</li>
<li>超级管理员系统<ul>
<li>头条信息维护</li>
<li>店铺类别信息维护</li>
<li>区域信息维护</li>
<li>权限验证</li>
<li>店铺管理</li>
<li>用户管理</li>
</ul>
</li>
</ul>
<h2 id="2-2-实体类设计与表创建"><a href="#2-2-实体类设计与表创建" class="headerlink" title="2-2 实体类设计与表创建"></a>2-2 实体类设计与表创建</h2><p><img src="C:%5CUsers%5Cadmin%5CDesktop%5Cblog%5Csource%5Cimages%5C2019032301.png" alt="image-20210531134406946"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="string">`o2o`</span> </span><br><span class="line"><span class="keyword">USE</span> <span class="string">`o2o`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`tb_area`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tb_area`</span> (</span><br><span class="line">  <span class="string">`area_id`</span> <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`area_name`</span> <span class="built_in">varchar</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`priority`</span> <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`last_edit_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`area_id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`UK_AREA`</span> (<span class="string">`area_name`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`tb_head_line`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tb_head_line`</span> (</span><br><span class="line">  <span class="string">`line_id`</span> <span class="built_in">int</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`line_name`</span> <span class="built_in">varchar</span>(<span class="number">1000</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`line_link`</span> <span class="built_in">varchar</span>(<span class="number">2000</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`line_img`</span> <span class="built_in">varchar</span>(<span class="number">2000</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`priority`</span> <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`enable_status`</span> <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`last_edit_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`line_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`tb_local_auth`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tb_local_auth`</span> (</span><br><span class="line">  <span class="string">`local_auth_id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`user_id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`username`</span> <span class="built_in">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`password`</span> <span class="built_in">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`last_edit_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`local_auth_id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`uk_local_profile`</span> (<span class="string">`username`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`fk_localauth_profile`</span> (<span class="string">`user_id`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`fk_localauth_profile`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`user_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`tb_person_info`</span> (<span class="string">`user_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`tb_person_info`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tb_person_info`</span> (</span><br><span class="line">  <span class="string">`user_id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`profile_img`</span> <span class="built_in">varchar</span>(<span class="number">1024</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`email`</span> <span class="built_in">varchar</span>(<span class="number">1024</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`gender`</span> <span class="built_in">varchar</span>(<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`enable_status`</span> <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> <span class="keyword">COMMENT</span> <span class="string">'0:禁止使用本商城，1:允许使用本商城'</span>,</span><br><span class="line">  <span class="string">`user_type`</span> <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'1'</span> <span class="keyword">COMMENT</span> <span class="string">'1:顾客，2:店家，3:超级管理员'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`last_edit_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`user_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`tb_product`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tb_product`</span> (</span><br><span class="line">  <span class="string">`product_id`</span> <span class="built_in">int</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`product_name`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`product_desc`</span> <span class="built_in">varchar</span>(<span class="number">2000</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`img_addr`</span> <span class="built_in">varchar</span>(<span class="number">2000</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`normal_price`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`promotion_price`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`priority`</span> <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`last_edit_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`enable_status`</span> <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`product_category_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`shop_id`</span> <span class="built_in">int</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`product_id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`fk_product_procate`</span> (<span class="string">`product_category_id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`fk_product_shop`</span> (<span class="string">`shop_id`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`fk_product_procate`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`product_category_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`tb_product_category`</span> (<span class="string">`product_category_id`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`fk_product_shop`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`shop_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`tb_shop`</span> (<span class="string">`shop_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`tb_product_category`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tb_product_category`</span> (</span><br><span class="line">  <span class="string">`product_category_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`product_category_name`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`priority`</span> <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`shop_id`</span> <span class="built_in">int</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`product_category_id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`fk_procate_shop`</span> (<span class="string">`shop_id`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`fk_procate_shop`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`shop_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`tb_shop`</span> (<span class="string">`shop_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`tb_product_img`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tb_product_img`</span> (</span><br><span class="line">  <span class="string">`product_img_id`</span> <span class="built_in">int</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`img_addr`</span> <span class="built_in">varchar</span>(<span class="number">2000</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`img_desc`</span> <span class="built_in">varchar</span>(<span class="number">2000</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`priority`</span> <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`product_id`</span> <span class="built_in">int</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`product_img_id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`fk_proimg_product`</span> (<span class="string">`product_id`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`fk_proimg_product`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`product_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`tb_product`</span> (<span class="string">`product_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`tb_shop`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tb_shop`</span> (</span><br><span class="line">  <span class="string">`shop_id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`owner_id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'店铺创建人'</span>,</span><br><span class="line">  <span class="string">`area_id`</span> <span class="built_in">int</span>(<span class="number">5</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`shop_category_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`shop_name`</span> <span class="built_in">varchar</span>(<span class="number">256</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`shop_desc`</span> <span class="built_in">varchar</span>(<span class="number">1024</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`shop_addr`</span> <span class="built_in">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`phone`</span> <span class="built_in">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`shop_img`</span> <span class="built_in">varchar</span>(<span class="number">1024</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`priority`</span> <span class="built_in">int</span>(<span class="number">3</span>) <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`last_edit_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`enable_status`</span> <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`advice`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`shop_id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`fk_shop_area`</span> (<span class="string">`area_id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`fk_shop_profile`</span> (<span class="string">`owner_id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`fk_shop_shopcate`</span> (<span class="string">`shop_category_id`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`fk_shop_area`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`area_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`tb_area`</span> (<span class="string">`area_id`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`fk_shop_profile`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`owner_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`tb_person_info`</span> (<span class="string">`user_id`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`fk_shop_shopcate`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`shop_category_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`tb_shop_category`</span> (<span class="string">`shop_category_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`tb_shop_category`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tb_shop_category`</span> (</span><br><span class="line">  <span class="string">`shop_category_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`shop_category_name`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`shop_category_desc`</span> <span class="built_in">varchar</span>(<span class="number">1000</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`shop_category_img`</span> <span class="built_in">varchar</span>(<span class="number">2000</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`priority`</span> <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`last_edit_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`parent_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`shop_category_id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`fk_shop_category_self`</span> (<span class="string">`parent_id`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`fk_shop_category_self`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`parent_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`tb_shop_category`</span> (<span class="string">`shop_category_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`tb_wechat_auth`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tb_wechat_auth`</span> (</span><br><span class="line">  <span class="string">`wechat_auth_id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`user_id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`open_id`</span> <span class="built_in">varchar</span>(<span class="number">80</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`wechat_auth_id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`open_id`</span> (<span class="string">`open_id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`fk_wechatauth_profile`</span> (<span class="string">`user_id`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`fk_wechatauth_profile`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`user_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`tb_person_info`</span> (<span class="string">`user_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure>



<h2 id="2-3-配置Maven"><a href="#2-3-配置Maven" class="headerlink" title="2-3 配置Maven"></a>2-3 配置Maven</h2><h2 id="2-4-逐层完成SSM的各项配置"><a href="#2-4-逐层完成SSM的各项配置" class="headerlink" title="2-4 逐层完成SSM的各项配置"></a>2-4 逐层完成SSM的各项配置</h2><blockquote>
<p>快速构建SSM开发环境:<a href="https://liuurick.github.io/2020/12/01/%E5%BF%AB%E9%80%9F%E6%9E%84%E5%BB%BASSM%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/" target="_blank" rel="noopener">https://liuurick.github.io/2020/12/01/%E5%BF%AB%E9%80%9F%E6%9E%84%E5%BB%BASSM%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/</a></p>
</blockquote>
<h2 id="2-5-升级mysql驱动相关的配置以支持mysql8"><a href="#2-5-升级mysql驱动相关的配置以支持mysql8" class="headerlink" title="2-5 升级mysql驱动相关的配置以支持mysql8"></a>2-5 升级mysql驱动相关的配置以支持mysql8</h2><p>mysql5:<code>com.mysql.jdbc.Driver</code></p>
<p>mysql8:<code>com.mysql.cj.jdbc.Driver</code></p>
<h2 id="2-6-验证Sevice与Controller"><a href="#2-6-验证Sevice与Controller" class="headerlink" title="2-6 验证Sevice与Controller"></a>2-6 验证Sevice与Controller</h2><p>对于MVC架构而言，单元测试只需要测试service层即可</p>
<h1 id="3-Logback配置与使用"><a href="#3-Logback配置与使用" class="headerlink" title="3 Logback配置与使用"></a>3 Logback配置与使用</h1><blockquote>
<p>Logback配置与使用:<a href="https://liuurick.github.io/2018/10/31/Logback%E9%85%8D%E7%BD%AE%E4%B8%8E%E4%BD%BF%E7%94%A8/" target="_blank" rel="noopener">https://liuurick.github.io/2018/10/31/Logback%E9%85%8D%E7%BD%AE%E4%B8%8E%E4%BD%BF%E7%94%A8/</a></p>
</blockquote>
<h1 id="4-店铺注册功能模块"><a href="#4-店铺注册功能模块" class="headerlink" title="4 店铺注册功能模块"></a>4 店铺注册功能模块</h1><h2 id="4-1-Dao层之新增店铺"><a href="#4-1-Dao层之新增店铺" class="headerlink" title="4-1 Dao层之新增店铺"></a>4-1 Dao层之新增店铺</h2><h2 id="4-2-Dao层之更新店铺"><a href="#4-2-Dao层之更新店铺" class="headerlink" title="4-2 Dao层之更新店铺"></a>4-2 Dao层之更新店铺</h2><h2 id="4-3-Thumbnailator图片处理和封装Util"><a href="#4-3-Thumbnailator图片处理和封装Util" class="headerlink" title="4-3 Thumbnailator图片处理和封装Util"></a>4-3 Thumbnailator图片处理和封装Util</h2><h2 id="4-4-Dto之ShopExecution的实现"><a href="#4-4-Dto之ShopExecution的实现" class="headerlink" title="4-4 Dto之ShopExecution的实现"></a>4-4 Dto之ShopExecution的实现</h2><p>引入DTO，ShopExecution是一个数据传输对象（DTO)(Data Transfer Object)，是一种设计模式之间传输数据的软件应用系统。数据传输目标往往是数据访问对象从数据库中检索数据。</p>
<p><code>数据传输对象</code>与<code>数据交互对象</code>或<code>数据访问对象</code>之间的差异是一个以不具有任何行为除了存储和检索的数据。</p>
<h2 id="4-5-店铺注册之Service层的实现"><a href="#4-5-店铺注册之Service层的实现" class="headerlink" title="4-5 店铺注册之Service层的实现"></a>4-5 店铺注册之Service层的实现</h2><h2 id="4-6-店铺注册功能之Controller层的实现与改造"><a href="#4-6-店铺注册功能之Controller层的实现与改造" class="headerlink" title="4-6 店铺注册功能之Controller层的实现与改造"></a>4-6 店铺注册功能之Controller层的实现与改造</h2><h2 id="4-7-店铺注册之前端设计"><a href="#4-7-店铺注册之前端设计" class="headerlink" title="4-7 店铺注册之前端设计"></a>4-7 店铺注册之前端设计</h2><blockquote>
<p>SUI mobile:<a href="http://sui.yater.net/" target="_blank" rel="noopener">http://sui.yater.net/</a></p>
<p>MUI:<a href="https://dev.dcloud.net.cn/mui/" target="_blank" rel="noopener">https://dev.dcloud.net.cn/mui/</a></p>
</blockquote>
<p>使用阿里巴巴的SUI mobile框架</p>
<h2 id="4-8-店铺注册之js实现"><a href="#4-8-店铺注册之js实现" class="headerlink" title="4-8 店铺注册之js实现"></a>4-8 店铺注册之js实现</h2><h2 id="4-9-店铺类别区域信息的获取"><a href="#4-9-店铺类别区域信息的获取" class="headerlink" title="4-9 店铺类别区域信息的获取"></a>4-9 店铺类别区域信息的获取</h2><h2 id="4-10-引入kaptcha实现验证码"><a href="#4-10-引入kaptcha实现验证码" class="headerlink" title="4-10 引入kaptcha实现验证码"></a>4-10 引入kaptcha实现验证码</h2><p><strong>后端：</strong></p>
<p>1.引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.penggle<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kaptcha<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;kaptcha.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.web.xml设定样式</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Kaptcha<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.google.code.kaptcha.servlet.KaptchaServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 是否有边框 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>kaptcha.border<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>no<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 字体颜色 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>kaptcha.textproducer.font.color<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>red<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 图片宽度 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>kaptcha.image.width<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>135<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用哪些字符生成验证码 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>kaptcha.textproducer.char.string<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>ACDEFHKPRSTWX345679<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 图片高度 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>kaptcha.image.height<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>50<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 字体大小 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>kaptcha.textproducer.font.size<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>43<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 干扰线的颜色 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>kaptcha.noise.color<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>black<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 字符个数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>kaptcha.textproducer.char.length<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>4<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 字体 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>kaptcha.textproducer.font.names<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>Arial<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Kaptcha<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/Kaptcha<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3.编写工具类检验验证码是否和预期相符</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CodeUtil</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 检查验证码是否和预期相符</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">checkVerifyCode</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">		String verifyCodeExpected = (String) request.getSession()</span><br><span class="line">				.getAttribute(com.google.code.kaptcha.Constants.KAPTCHA_SESSION_KEY);</span><br><span class="line">		String verifyCodeActual = HttpServletRequestUtil.getString(request, <span class="string">"verifyCodeActual"</span>);</span><br><span class="line">		<span class="keyword">if</span> (verifyCodeActual == <span class="keyword">null</span> || !verifyCodeActual.equals(verifyCodeExpected)) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.controller判断</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,Object&gt; modelMap = <span class="keyword">new</span> HashMap&lt;String,Object&gt;();</span><br><span class="line"><span class="comment">//验证码校验</span></span><br><span class="line"><span class="keyword">if</span> (!CodeUtil.checkVerifyCode(request)) &#123;</span><br><span class="line">	modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">	modelMap.put(<span class="string">"errMsg"</span>, <span class="string">"输入了错误的验证码"</span>);</span><br><span class="line">	<span class="keyword">return</span> modelMap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>前端</strong>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 验证码 Kaptcha --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-content"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-inner"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-title label"</span>&gt;</span>验证码<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"j_captcha"</span> <span class="attr">placeholder</span>=<span class="string">"验证码"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-input"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"captcha_img"</span> <span class="attr">alt</span>=<span class="string">"点击更换"</span> <span class="attr">title</span>=<span class="string">"点击更换"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">onclick</span>=<span class="string">"changeVerifyCode(this)"</span> <span class="attr">src</span>=<span class="string">"../Kaptcha"</span> /&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">changeVerifyCode</span>(<span class="params">img</span>) </span>&#123;</span><br><span class="line">	img.src = <span class="string">"../Kaptcha?"</span> + <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">100</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="5-主从库同步与读写分离"><a href="#5-主从库同步与读写分离" class="headerlink" title="5 主从库同步与读写分离"></a>5 主从库同步与读写分离</h1><blockquote>
<p>主从库同步与读写分离:<a href="https://liuurick.github.io/2018/10/31/%E4%B8%BB%E4%BB%8E%E5%BA%93%E5%90%8C%E6%AD%A5%E4%B8%8E%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB/" target="_blank" rel="noopener">https://liuurick.github.io/2018/10/31/%E4%B8%BB%E4%BB%8E%E5%BA%93%E5%90%8C%E6%AD%A5%E4%B8%8E%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB/</a></p>
</blockquote>
<h1 id="6-店铺编辑和列表功能"><a href="#6-店铺编辑和列表功能" class="headerlink" title="6 店铺编辑和列表功能"></a>6 店铺编辑和列表功能</h1><p>6-1 店铺信息编辑之Dao层开发<br>6-2 店铺信息编辑之Service层的实现<br>6-3 店铺信息编辑之Controller层实现<br>6-4 店铺信息编辑之前端实现<br>6-5 店铺列表展示之Dao层的实现<br>6-6 店铺列表展示之Service层的实现<br>6-7 店铺列表展示之Contoller层的实现<br>6-8 店铺列表展示前端开发<br>6-9 店铺管理页面的前端开发</p>
<h1 id="7-商品类别模块"><a href="#7-商品类别模块" class="headerlink" title="7 商品类别模块"></a>7 商品类别模块</h1><p>7-1 商铺类别展示<br>7-3 商品类别批量添加后端开发</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"batchInsertProductCategory"</span> <span class="attr">parameterType</span>=<span class="string">"java.util.List"</span>&gt;</span></span><br><span class="line">        INSERT INTO</span><br><span class="line">        tb_product_category(product_category_name, priority,</span><br><span class="line">        create_time, shop_id)</span><br><span class="line">        VALUES</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"productCategory"</span> <span class="attr">index</span>=<span class="string">"index"</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">separator</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">            (</span><br><span class="line">            #&#123;productCategory.productCategoryName&#125;,</span><br><span class="line">            #&#123;productCategory.priority&#125;,</span><br><span class="line">            #&#123;productCategory.createTime&#125;,</span><br><span class="line">            #&#123;productCategory.shopId&#125;</span><br><span class="line">            )</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>7-4 商品类别批量添加的前端开发<br>7-5 商品类别删除后端开发<br>7-6 商品类别删除前端开发</p>
<h1 id="8-商品模块"><a href="#8-商品模块" class="headerlink" title="8 商品模块"></a>8 商品模块</h1><h2 id="8-1-商品添加之Dao层的实现"><a href="#8-1-商品添加之Dao层的实现" class="headerlink" title="8-1 商品添加之Dao层的实现"></a>8-1 商品添加之Dao层的实现</h2><h2 id="8-2-商品添加之Service层的实现"><a href="#8-2-商品添加之Service层的实现" class="headerlink" title="8-2 商品添加之Service层的实现"></a>8-2 商品添加之Service层的实现</h2><h2 id="8-3-商品添加之Controller层的实现"><a href="#8-3-商品添加之Controller层的实现" class="headerlink" title="8-3 商品添加之Controller层的实现"></a>8-3 商品添加之Controller层的实现</h2><h2 id="8-4-商品添加之前端"><a href="#8-4-商品添加之前端" class="headerlink" title="8-4 商品添加之前端"></a>8-4 商品添加之前端</h2><h2 id="8-5-商品编辑之后端开发"><a href="#8-5-商品编辑之后端开发" class="headerlink" title="8-5 商品编辑之后端开发"></a>8-5 商品编辑之后端开发</h2><h2 id="8-6-商品编辑之前端实现"><a href="#8-6-商品编辑之前端实现" class="headerlink" title="8-6 商品编辑之前端实现"></a>8-6 商品编辑之前端实现</h2><h2 id="8-7-商品列表展示之后端开发"><a href="#8-7-商品列表展示之后端开发" class="headerlink" title="8-7 商品列表展示之后端开发"></a>8-7 商品列表展示之后端开发</h2><h2 id="8-8-商品列表展示之前端开发"><a href="#8-8-商品列表展示之前端开发" class="headerlink" title="8-8 商品列表展示之前端开发"></a>8-8 商品列表展示之前端开发</h2><h2 id="8-9-解除商品与某商品类别的关联的实现"><a href="#8-9-解除商品与某商品类别的关联的实现" class="headerlink" title="8-9 解除商品与某商品类别的关联的实现"></a>8-9 解除商品与某商品类别的关联的实现</h2><p>将此类别下的商品里的类别id置为空，再删除掉该商品类别</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateProductCategoryToNull"</span> <span class="attr">parameterType</span>=<span class="string">"long"</span>&gt;</span></span><br><span class="line">   UPDATE</span><br><span class="line">   tb_product</span><br><span class="line">   SET</span><br><span class="line">   product_category_id = null</span><br><span class="line">   WHERE product_category_id =</span><br><span class="line">   #&#123;productCategoryId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ProductCategoryExecution <span class="title">deleteProductCategory</span><span class="params">(<span class="keyword">long</span> productCategoryId, <span class="keyword">long</span> shopId)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ProductCategoryOperationException </span>&#123;</span><br><span class="line">        <span class="comment">// 解除tb_product里的商品与该producategoryId的关联</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> effectedNum = productDao.updateProductCategoryToNull(productCategoryId);</span><br><span class="line">            <span class="keyword">if</span> (effectedNum &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ProductCategoryOperationException(<span class="string">"商品类别更新失败"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ProductCategoryOperationException(<span class="string">"deleteProductCategory error: "</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 删除该productCategory</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> effectedNum = productCategoryDao.deleteProductCategory(productCategoryId, shopId);</span><br><span class="line">            <span class="keyword">if</span> (effectedNum &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ProductCategoryOperationException(<span class="string">"商品类别删除失败"</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> ProductCategoryExecution(ProductCategoryStateEnum.SUCCESS);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ProductCategoryOperationException(<span class="string">"deleteProductCategory error:"</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>





<h1 id="9-前端展示系统"><a href="#9-前端展示系统" class="headerlink" title="9 前端展示系统"></a>9 前端展示系统</h1><h2 id="9-1-首页后台的开发"><a href="#9-1-首页后台的开发" class="headerlink" title="9-1 首页后台的开发"></a>9-1 首页后台的开发</h2><h2 id="9-2-首页前端的开发"><a href="#9-2-首页前端的开发" class="headerlink" title="9-2 首页前端的开发"></a>9-2 首页前端的开发</h2><h2 id="9-3-docBase与upload的含义"><a href="#9-3-docBase与upload的含义" class="headerlink" title="9-3 docBase与upload的含义"></a>9-3 docBase与upload的含义</h2><blockquote>
<p>server.xml中docBase和path的关系梳理:<a href="https://liuurick.github.io/2019/02/13/server-xml%E4%B8%ADdocBase%E5%92%8Cpath%E7%9A%84%E5%85%B3%E7%B3%BB%E6%A2%B3%E7%90%86/" target="_blank" rel="noopener">https://liuurick.github.io/2019/02/13/server-xml%E4%B8%ADdocBase%E5%92%8Cpath%E7%9A%84%E5%85%B3%E7%B3%BB%E6%A2%B3%E7%90%86/</a></p>
</blockquote>
<h2 id="9-4-店铺列表页后端的开发"><a href="#9-4-店铺列表页后端的开发" class="headerlink" title="9-4 店铺列表页后端的开发"></a>9-4 店铺列表页后端的开发</h2><h2 id="9-5-店铺列表页前端的开发"><a href="#9-5-店铺列表页前端的开发" class="headerlink" title="9-5 店铺列表页前端的开发"></a>9-5 店铺列表页前端的开发</h2><h2 id="9-6-店铺详情页的开发"><a href="#9-6-店铺详情页的开发" class="headerlink" title="9-6 店铺详情页的开发"></a>9-6 店铺详情页的开发</h2><h2 id="9-7-商品详情页的开发"><a href="#9-7-商品详情页的开发" class="headerlink" title="9-7 商品详情页的开发"></a>9-7 商品详情页的开发</h2><h2 id="9-8-前端展示系统bug修复"><a href="#9-8-前端展示系统bug修复" class="headerlink" title="9-8 前端展示系统bug修复"></a>9-8 前端展示系统bug修复</h2><h1 id="10-阿里云部署及远程微信开发调试心得与技巧"><a href="#10-阿里云部署及远程微信开发调试心得与技巧" class="headerlink" title="10 阿里云部署及远程微信开发调试心得与技巧"></a>10 阿里云部署及远程微信开发调试心得与技巧</h1><h2 id="10-1-阿里云初始化与执行环境安装"><a href="#10-1-阿里云初始化与执行环境安装" class="headerlink" title="10-1 阿里云初始化与执行环境安装"></a>10-1 阿里云初始化与执行环境安装</h2><h2 id="10-2-项目打包发布与域名解析"><a href="#10-2-项目打包发布与域名解析" class="headerlink" title="10-2 项目打包发布与域名解析"></a>10-2 项目打包发布与域名解析</h2><h2 id="10-3-微信测试号的申请与连接"><a href="#10-3-微信测试号的申请与连接" class="headerlink" title="10-3 微信测试号的申请与连接"></a>10-3 微信测试号的申请与连接</h2><h2 id="10-4-微信登录帐号的创建"><a href="#10-4-微信登录帐号的创建" class="headerlink" title="10-4 微信登录帐号的创建"></a>10-4 微信登录帐号的创建</h2><h1 id="11-项目优化"><a href="#11-项目优化" class="headerlink" title="11 项目优化"></a>11 项目优化</h1><h2 id="11-1-对关键配置信息进行DES加密"><a href="#11-1-对关键配置信息进行DES加密" class="headerlink" title="11-1 对关键配置信息进行DES加密"></a>11-1 对关键配置信息进行DES加密</h2><p>加密连接数据库明文密码，利用PropertyPlaceholderConfigurer实现对称加密。</p>
<p>DESUtil</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * DES是一种对称加密算法，所谓对称加密算法即：加密和解密使用相同密钥的算法。</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liubin</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DESUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Key key;</span><br><span class="line">	<span class="comment">// 设置密钥key</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String KEY_STR = <span class="string">"myKey"</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String CHARSETNAME = <span class="string">"UTF-8"</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String ALGORITHM = <span class="string">"DES"</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 生成DES算法对象</span></span><br><span class="line">			KeyGenerator generator = KeyGenerator.getInstance(ALGORITHM);</span><br><span class="line">			<span class="comment">// 运用SHA1安全策略</span></span><br><span class="line">			SecureRandom secureRandom = SecureRandom.getInstance(<span class="string">"SHA1PRNG"</span>);</span><br><span class="line">			<span class="comment">// 设置上密钥种子</span></span><br><span class="line">			secureRandom.setSeed(KEY_STR.getBytes());</span><br><span class="line">			<span class="comment">// 初始化基于SHA1的算法对象</span></span><br><span class="line">			generator.init(secureRandom);</span><br><span class="line">			<span class="comment">// 生成密钥对象</span></span><br><span class="line">			key = generator.generateKey();</span><br><span class="line">			generator = <span class="keyword">null</span>;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取加密后的信息</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> str</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getEncryptString</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 基于BASE64编码，接收byte[]并转换成String</span></span><br><span class="line">		BASE64Encoder base64encoder = <span class="keyword">new</span> BASE64Encoder();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 按UTF8编码</span></span><br><span class="line">			<span class="keyword">byte</span>[] bytes = str.getBytes(CHARSETNAME);</span><br><span class="line">			<span class="comment">// 获取加密对象</span></span><br><span class="line">			Cipher cipher = Cipher.getInstance(ALGORITHM);</span><br><span class="line">			<span class="comment">// 初始化密码信息</span></span><br><span class="line">			cipher.init(Cipher.ENCRYPT_MODE, key);</span><br><span class="line">			<span class="comment">// 加密</span></span><br><span class="line">			<span class="keyword">byte</span>[] doFinal = cipher.doFinal(bytes);</span><br><span class="line">			<span class="comment">// byte[]to encode好的String并返回</span></span><br><span class="line">			<span class="keyword">return</span> base64encoder.encode(doFinal);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取解密之后的信息</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> str</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getDecryptString</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 基于BASE64编码，接收byte[]并转换成String</span></span><br><span class="line">		BASE64Decoder base64decoder = <span class="keyword">new</span> BASE64Decoder();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 将字符串decode成byte[]</span></span><br><span class="line">			<span class="keyword">byte</span>[] bytes = base64decoder.decodeBuffer(str);</span><br><span class="line">			<span class="comment">// 获取解密对象</span></span><br><span class="line">			Cipher cipher = Cipher.getInstance(ALGORITHM);</span><br><span class="line">			<span class="comment">// 初始化解密信息</span></span><br><span class="line">			cipher.init(Cipher.DECRYPT_MODE, key);</span><br><span class="line">			<span class="comment">// 解密</span></span><br><span class="line">			<span class="keyword">byte</span>[] doFinal = cipher.doFinal(bytes);</span><br><span class="line">			<span class="comment">// 返回解密之后的信息</span></span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> String(doFinal, CHARSETNAME);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		System.out.println(getEncryptString(<span class="string">"root"</span>));</span><br><span class="line">		System.out.println(getEncryptString(<span class="string">"123123!"</span>));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>EncryptPropertyPlaceholderConfigurer</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EncryptPropertyPlaceholderConfigurer</span> <span class="keyword">extends</span> <span class="title">PropertyPlaceholderConfigurer</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 需要加密的字段数组</span></span><br><span class="line">	<span class="keyword">private</span> String[] encryptPropNames = &#123; <span class="string">"jdbc.username"</span>, <span class="string">"jdbc.password"</span> &#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 对关键的属性进行转换</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> String <span class="title">convertProperty</span><span class="params">(String propertyName, String propertyValue)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (isEncryptProp(propertyName)) &#123;</span><br><span class="line">			<span class="comment">// 对已加密的字段进行解密工作</span></span><br><span class="line">			String decryptValue = DESUtil.getDecryptString(propertyValue);</span><br><span class="line">			<span class="keyword">return</span> decryptValue;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> propertyValue;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 该属性是否已加密</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> propertyName</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isEncryptProp</span><span class="params">(String propertyName)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 若等于需要加密的field，则进行加密</span></span><br><span class="line">		<span class="keyword">for</span> (String encryptpropertyName : encryptPropNames) &#123;</span><br><span class="line">			<span class="keyword">if</span> (encryptpropertyName.equals(propertyName)) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改spring-dao.xml配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1.配置数据库相关参数properties的属性：$&#123;url&#125; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.liuurick.o2o.util.EncryptPropertyPlaceholderConfigurer"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"locations"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:jdbc.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:redis.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"fileEncoding"</span> <span class="attr">value</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="11-2-引入缓存技术Redis"><a href="#11-2-引入缓存技术Redis" class="headerlink" title="11-2 引入缓存技术Redis"></a>11-2 引入缓存技术Redis</h2><p>将不经常变更的数据放在Redis，不仅可以提高访问速度，而且可以减轻数据库压力</p>
<p><img src="C:%5CUsers%5Cadmin%5CDesktop%5Cblog%5Csource%5Cimages%5C2019032302.png" alt="image-20210531202418622"></p>
<h3 id="Redis配置"><a href="#Redis配置" class="headerlink" title="Redis配置"></a>Redis配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- Redis连接池的设置 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisPoolConfig"</span> <span class="attr">class</span>=<span class="string">"redis.clients.jedis.JedisPoolConfig"</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 控制一个pool可分配多少个jedis实例 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxTotal"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.pool.maxActive&#125;"</span> /&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 连接池中最多可空闲maxIdle个连接 ，这里取值为20，表示即使没有数据库连接时依然可以保持20空闲的连接，而不被清除，随时处于待命状态。 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxIdle"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.pool.maxIdle&#125;"</span> /&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 最大等待时间:当没有可用连接时,连接池等待连接被归还的最大时间(以毫秒计数),超过时间则抛出异常 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxWaitMillis"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.pool.maxWait&#125;"</span> /&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 在获取连接的时候检查有效性 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testOnBorrow"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.pool.testOnBorrow&#125;"</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- 创建Redis连接池，并做相关配置 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisWritePool"</span> <span class="attr">class</span>=<span class="string">"com.liuurick.o2o.cache.JedisPoolWriper"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">depends-on</span>=<span class="string">"jedisPoolConfig"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">ref</span>=<span class="string">"jedisPoolConfig"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"1"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.hostname&#125;"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"2"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis.port&#125;"</span> <span class="attr">type</span>=<span class="string">"int"</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- 创建Redis工具类，封装好Redis的连接以进行相关的操作 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisUtil"</span> <span class="attr">class</span>=<span class="string">"com.liuurick.o2o.cache.JedisUtil"</span> <span class="attr">scope</span>=<span class="string">"singleton"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jedisPool"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"jedisWritePool"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- Redis的key操作 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisKeys"</span> <span class="attr">class</span>=<span class="string">"com.liuurick.o2o.cache.JedisUtil$Keys"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">scope</span>=<span class="string">"singleton"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">"jedisUtil"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- Redis的Strings操作 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisStrings"</span> <span class="attr">class</span>=<span class="string">"com.liuurick.o2o.cache.JedisUtil$Strings"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">scope</span>=<span class="string">"singleton"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">"jedisUtil"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- Redis的Lists操作 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisLists"</span> <span class="attr">class</span>=<span class="string">"com.liuurick.o2o.cache.JedisUtil$Lists"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">scope</span>=<span class="string">"singleton"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">"jedisUtil"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- Redis的Sets操作 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisSets"</span> <span class="attr">class</span>=<span class="string">"com.liuurick.o2o.cache.JedisUtil$Sets"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">scope</span>=<span class="string">"singleton"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">"jedisUtil"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- Redis的HashMap操作 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisHash"</span> <span class="attr">class</span>=<span class="string">"com.liuurick.o2o.cache.JedisUtil$Hash"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">scope</span>=<span class="string">"singleton"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">"jedisUtil"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>redis.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">redis.hostname</span>=<span class="string">127.0.0.1</span></span><br><span class="line"><span class="meta">redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="meta">redis.database</span>=<span class="string">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">redis.pool.maxActive</span>=<span class="string">100</span></span><br><span class="line"><span class="meta">redis.pool.maxIdle</span>=<span class="string">20</span></span><br><span class="line"><span class="meta">redis.pool.maxWait</span>=<span class="string">3000</span></span><br><span class="line"><span class="meta">redis.pool.testOnBorrow</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>



<h3 id="缓存操作封装"><a href="#缓存操作封装" class="headerlink" title="缓存操作封装"></a>缓存操作封装</h3><p>1.引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- redis客户端:Jedis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jedis.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.JedisPoolWriper与JedisUtil</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 强指定redis的JedisPool接口构造函数，这样才能在centos成功创建jedispool</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisPoolWriper</span> </span>&#123;</span><br><span class="line">   <span class="comment">/** Redis连接池对象 */</span></span><br><span class="line">   <span class="keyword">private</span> JedisPool jedisPool;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">JedisPoolWriper</span><span class="params">(<span class="keyword">final</span> JedisPoolConfig poolConfig, <span class="keyword">final</span> String host,</span></span></span><br><span class="line"><span class="function"><span class="params">         <span class="keyword">final</span> <span class="keyword">int</span> port)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         jedisPool = <span class="keyword">new</span> JedisPool(poolConfig, host, port);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 获取Redis连接池对象</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> JedisPool <span class="title">getJedisPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> jedisPool;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 注入Redis连接池对象</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> jedisPool</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJedisPool</span><span class="params">(JedisPool jedisPool)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.jedisPool = jedisPool;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuurick.o2o.cache;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.BinaryClient.LIST_POSITION;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.SortingParams;</span><br><span class="line"><span class="keyword">import</span> redis.clients.util.SafeEncoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisUtil</span> </span>&#123;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 缓存生存时间</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> expire = <span class="number">60000</span>;</span><br><span class="line">   <span class="comment">/** 操作Key的方法 */</span></span><br><span class="line">   <span class="keyword">public</span> Keys KEYS;</span><br><span class="line">   <span class="comment">/** 对存储结构为String类型的操作 */</span></span><br><span class="line">   <span class="keyword">public</span> Strings STRINGS;</span><br><span class="line">   <span class="comment">/** 对存储结构为List类型的操作 */</span></span><br><span class="line">   <span class="keyword">public</span> Lists LISTS;</span><br><span class="line">   <span class="comment">/** 对存储结构为Set类型的操作 */</span></span><br><span class="line">   <span class="keyword">public</span> Sets SETS;</span><br><span class="line">   <span class="comment">/** 对存储结构为HashMap类型的操作 */</span></span><br><span class="line">   <span class="keyword">public</span> Hash HASH;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/** Redis连接池对象 */</span></span><br><span class="line">   <span class="keyword">private</span> JedisPool jedisPool;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 获取redis连接池</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> JedisPool <span class="title">getJedisPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> jedisPool;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 设置redis连接池</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJedisPool</span><span class="params">(JedisPoolWriper jedisPoolWriper)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.jedisPool = jedisPoolWriper.getJedisPool();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 从jedis连接池中获取获取jedis对象</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Jedis <span class="title">getJedis</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> jedisPool.getResource();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 设置过期时间</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@author</span> xiangze</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> seconds</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">expire</span><span class="params">(String key, <span class="keyword">int</span> seconds)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (seconds &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      Jedis jedis = getJedis();</span><br><span class="line">      jedis.expire(key, seconds);</span><br><span class="line">      jedis.close();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 设置默认过期时间</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@author</span> xiangze</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">expire</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">      expire(key, expire);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// *******************************************Keys*******************************************//</span></span><br><span class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Keys</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 清空所有key</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">flushAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         String stata = jedis.flushAll();</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> stata;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 更改key</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            oldkey</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            newkey</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 状态码</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">rename</span><span class="params">(String oldkey, String newkey)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> rename(SafeEncoder.encode(oldkey), SafeEncoder.encode(newkey));</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 更改key,仅当新key不存在时才执行</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            oldkey</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            newkey</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 状态码</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">renamenx</span><span class="params">(String oldkey, String newkey)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> status = jedis.renamenx(oldkey, newkey);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> status;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 更改key</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            oldkey</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            newkey</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 状态码</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">rename</span><span class="params">(<span class="keyword">byte</span>[] oldkey, <span class="keyword">byte</span>[] newkey)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         String status = jedis.rename(oldkey, newkey);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> status;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 设置key的过期时间，以秒为单位</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> 时间</span></span><br><span class="line"><span class="comment">       *            ,已秒为单位</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 影响的记录数</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">expired</span><span class="params">(String key, <span class="keyword">int</span> seconds)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> count = jedis.expire(key, seconds);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> count;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 设置key的过期时间,它是距历元（即格林威治标准时间 1970 年 1 月 1 日的 00:00:00，格里高利历）的偏移量。</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> 时间</span></span><br><span class="line"><span class="comment">       *            ,已秒为单位</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 影响的记录数</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">expireAt</span><span class="params">(String key, <span class="keyword">long</span> timestamp)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> count = jedis.expireAt(key, timestamp);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> count;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 查询key的过期时间</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 以秒为单位的时间表示</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">ttl</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">         <span class="comment">// ShardedJedis sjedis = getShardedJedis();</span></span><br><span class="line">         Jedis sjedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> len = sjedis.ttl(key);</span><br><span class="line">         sjedis.close();</span><br><span class="line">         <span class="keyword">return</span> len;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 取消对key过期时间的设置</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 影响的记录数</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">persist</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> count = jedis.persist(key);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> count;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 删除keys对应的记录,可以是多个key</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            ... keys</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 删除的记录数</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">del</span><span class="params">(String... keys)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> count = jedis.del(keys);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> count;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 删除keys对应的记录,可以是多个key</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            ... keys</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 删除的记录数</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">del</span><span class="params">(<span class="keyword">byte</span>[]... keys)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> count = jedis.del(keys);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> count;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 判断key是否存在</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> boolean</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">exists</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">         <span class="comment">// ShardedJedis sjedis = getShardedJedis();</span></span><br><span class="line">         Jedis sjedis = getJedis();</span><br><span class="line">         <span class="keyword">boolean</span> exis = sjedis.exists(key);</span><br><span class="line">         sjedis.close();</span><br><span class="line">         <span class="keyword">return</span> exis;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 对List,Set,SortSet进行排序,如果集合数据较大应避免使用这个方法</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> List&lt;String&gt; 集合的全部记录</span></span><br><span class="line"><span class="comment">       **/</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">sort</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">         <span class="comment">// ShardedJedis sjedis = getShardedJedis();</span></span><br><span class="line">         Jedis sjedis = getJedis();</span><br><span class="line">         List&lt;String&gt; list = sjedis.sort(key);</span><br><span class="line">         sjedis.close();</span><br><span class="line">         <span class="keyword">return</span> list;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 对List,Set,SortSet进行排序或limit</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> SortingParams</span></span><br><span class="line"><span class="comment">       *            parame 定义排序类型或limit的起止位置.</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> List&lt;String&gt; 全部或部分记录</span></span><br><span class="line"><span class="comment">       **/</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">sort</span><span class="params">(String key, SortingParams parame)</span> </span>&#123;</span><br><span class="line">         <span class="comment">// ShardedJedis sjedis = getShardedJedis();</span></span><br><span class="line">         Jedis sjedis = getJedis();</span><br><span class="line">         List&lt;String&gt; list = sjedis.sort(key, parame);</span><br><span class="line">         sjedis.close();</span><br><span class="line">         <span class="keyword">return</span> list;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 返回指定key存储的类型</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> String string|list|set|zset|hash</span></span><br><span class="line"><span class="comment">       **/</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">type</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">         <span class="comment">// ShardedJedis sjedis = getShardedJedis();</span></span><br><span class="line">         Jedis sjedis = getJedis();</span><br><span class="line">         String type = sjedis.type(key);</span><br><span class="line">         sjedis.close();</span><br><span class="line">         <span class="keyword">return</span> type;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 查找所有匹配给定的模式的键</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key的表达式,*表示多个，？表示一个</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">keys</span><span class="params">(String pattern)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         Set&lt;String&gt; set = jedis.keys(pattern);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> set;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// *******************************************Strings*******************************************//</span></span><br><span class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Strings</span> </span>&#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 根据key获取记录</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 值</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">         <span class="comment">// ShardedJedis sjedis = getShardedJedis();</span></span><br><span class="line">         Jedis sjedis = getJedis();</span><br><span class="line">         String value = sjedis.get(key);</span><br><span class="line">         sjedis.close();</span><br><span class="line">         <span class="keyword">return</span> value;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 根据key获取记录</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> byte[]</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 值</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">byte</span>[] get(<span class="keyword">byte</span>[] key) &#123;</span><br><span class="line">         <span class="comment">// ShardedJedis sjedis = getShardedJedis();</span></span><br><span class="line">         Jedis sjedis = getJedis();</span><br><span class="line">         <span class="keyword">byte</span>[] value = sjedis.get(key);</span><br><span class="line">         sjedis.close();</span><br><span class="line">         <span class="keyword">return</span> value;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 添加记录,如果记录已存在将覆盖原有的value</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            value</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 状态码</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">set</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> set(SafeEncoder.encode(key), SafeEncoder.encode(value));</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 添加记录,如果记录已存在将覆盖原有的value</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            value</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 状态码</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">set</span><span class="params">(String key, <span class="keyword">byte</span>[] value)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> set(SafeEncoder.encode(key), value);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 添加记录,如果记录已存在将覆盖原有的value</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> byte[]</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> byte[]</span></span><br><span class="line"><span class="comment">       *            value</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 状态码</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">set</span><span class="params">(<span class="keyword">byte</span>[] key, <span class="keyword">byte</span>[] value)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         String status = jedis.set(key, value);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> status;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 添加有过期时间的记录</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> int</span></span><br><span class="line"><span class="comment">       *            seconds 过期时间，以秒为单位</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            value</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> String 操作状态</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">setEx</span><span class="params">(String key, <span class="keyword">int</span> seconds, String value)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         String str = jedis.setex(key, seconds, value);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> str;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 添加有过期时间的记录</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> int</span></span><br><span class="line"><span class="comment">       *            seconds 过期时间，以秒为单位</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            value</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> String 操作状态</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">setEx</span><span class="params">(<span class="keyword">byte</span>[] key, <span class="keyword">int</span> seconds, <span class="keyword">byte</span>[] value)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         String str = jedis.setex(key, seconds, value);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> str;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 添加一条记录，仅当给定的key不存在时才插入</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            value</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> long 状态码，1插入成功且key不存在，0未插入，key存在</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">setnx</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> str = jedis.setnx(key, value);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> str;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 从指定位置开始插入数据，插入的数据会覆盖指定位置以后的数据&lt;br/&gt;</span></span><br><span class="line"><span class="comment">       * 例:String str1="123456789";&lt;br/&gt;</span></span><br><span class="line"><span class="comment">       * 对str1操作后setRange(key,4,0000)，str1="123400009";</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> long</span></span><br><span class="line"><span class="comment">       *            offset</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            value</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> long value的长度</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">setRange</span><span class="params">(String key, <span class="keyword">long</span> offset, String value)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> len = jedis.setrange(key, offset, value);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> len;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 在指定的key中追加value</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            value</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> long 追加后value的长度</span></span><br><span class="line"><span class="comment">       **/</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">append</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> len = jedis.append(key, value);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> len;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 将key对应的value减去指定的值，只有value可以转为数字时该方法才可用</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> long</span></span><br><span class="line"><span class="comment">       *            number 要减去的值</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> long 减指定值后的值</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">decrBy</span><span class="params">(String key, <span class="keyword">long</span> number)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> len = jedis.decrBy(key, number);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> len;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * &lt;b&gt;可以作为获取唯一id的方法&lt;/b&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="comment">       * 将key对应的value加上指定的值，只有value可以转为数字时该方法才可用</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> long</span></span><br><span class="line"><span class="comment">       *            number 要减去的值</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> long 相加后的值</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">incrBy</span><span class="params">(String key, <span class="keyword">long</span> number)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> len = jedis.incrBy(key, number);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> len;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 对指定key对应的value进行截取</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> long</span></span><br><span class="line"><span class="comment">       *            startOffset 开始位置(包含)</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> long</span></span><br><span class="line"><span class="comment">       *            endOffset 结束位置(包含)</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> String 截取的值</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">getrange</span><span class="params">(String key, <span class="keyword">long</span> startOffset, <span class="keyword">long</span> endOffset)</span> </span>&#123;</span><br><span class="line">         <span class="comment">// ShardedJedis sjedis = getShardedJedis();</span></span><br><span class="line">         Jedis sjedis = getJedis();</span><br><span class="line">         String value = sjedis.getrange(key, startOffset, endOffset);</span><br><span class="line">         sjedis.close();</span><br><span class="line">         <span class="keyword">return</span> value;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取并设置指定key对应的value&lt;br/&gt;</span></span><br><span class="line"><span class="comment">       * 如果key存在返回之前的value,否则返回null</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            value</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> String 原始value或null</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">getSet</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         String str = jedis.getSet(key, value);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> str;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 批量获取记录,如果指定的key不存在返回List的对应位置将是null</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            keys</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> List&lt;String&gt; 值得集合</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">mget</span><span class="params">(String... keys)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         List&lt;String&gt; str = jedis.mget(keys);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> str;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 批量存储记录</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            keysvalues 例:keysvalues="key1","value1","key2","value2";</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> String 状态码</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">mset</span><span class="params">(String... keysvalues)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         String str = jedis.mset(keysvalues);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> str;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取key对应的值的长度</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> value值得长度</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">strlen</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> len = jedis.strlen(key);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> len;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// *******************************************Sets*******************************************//</span></span><br><span class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sets</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 向Set添加一条记录，如果member已存在返回0,否则返回1</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            member</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 操作码,0或1</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sadd</span><span class="params">(String key, String member)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> s = jedis.sadd(key, member);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> s;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sadd</span><span class="params">(<span class="keyword">byte</span>[] key, <span class="keyword">byte</span>[] member)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> s = jedis.sadd(key, member);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> s;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取给定key中元素个数</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 元素个数</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">scard</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">         <span class="comment">// ShardedJedis sjedis = getShardedJedis();</span></span><br><span class="line">         Jedis sjedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> len = sjedis.scard(key);</span><br><span class="line">         sjedis.close();</span><br><span class="line">         <span class="keyword">return</span> len;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 返回从第一组和所有的给定集合之间的差异的成员</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            ... keys</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 差异的成员集合</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">sdiff</span><span class="params">(String... keys)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         Set&lt;String&gt; set = jedis.sdiff(keys);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> set;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 这个命令等于sdiff,但返回的不是结果集,而是将结果集存储在新的集合中，如果目标已存在，则覆盖。</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            newkey 新结果集的key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            ... keys 比较的集合</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 新集合中的记录数</span></span><br><span class="line"><span class="comment">       **/</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sdiffstore</span><span class="params">(String newkey, String... keys)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> s = jedis.sdiffstore(newkey, keys);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> s;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 返回给定集合交集的成员,如果其中一个集合为不存在或为空，则返回空Set</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            ... keys</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 交集成员的集合</span></span><br><span class="line"><span class="comment">       **/</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">sinter</span><span class="params">(String... keys)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         Set&lt;String&gt; set = jedis.sinter(keys);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> set;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 这个命令等于sinter,但返回的不是结果集,而是将结果集存储在新的集合中，如果目标已存在，则覆盖。</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            newkey 新结果集的key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            ... keys 比较的集合</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 新集合中的记录数</span></span><br><span class="line"><span class="comment">       **/</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sinterstore</span><span class="params">(String newkey, String... keys)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> s = jedis.sinterstore(newkey, keys);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> s;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 确定一个给定的值是否存在</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            member 要判断的值</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 存在返回1，不存在返回0</span></span><br><span class="line"><span class="comment">       **/</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sismember</span><span class="params">(String key, String member)</span> </span>&#123;</span><br><span class="line">         <span class="comment">// ShardedJedis sjedis = getShardedJedis();</span></span><br><span class="line">         Jedis sjedis = getJedis();</span><br><span class="line">         <span class="keyword">boolean</span> s = sjedis.sismember(key, member);</span><br><span class="line">         sjedis.close();</span><br><span class="line">         <span class="keyword">return</span> s;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 返回集合中的所有成员</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 成员集合</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">smembers</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">         <span class="comment">// ShardedJedis sjedis = getShardedJedis();</span></span><br><span class="line">         Jedis sjedis = getJedis();</span><br><span class="line">         Set&lt;String&gt; set = sjedis.smembers(key);</span><br><span class="line">         sjedis.close();</span><br><span class="line">         <span class="keyword">return</span> set;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">public</span> Set&lt;<span class="keyword">byte</span>[]&gt; smembers(<span class="keyword">byte</span>[] key) &#123;</span><br><span class="line">         <span class="comment">// ShardedJedis sjedis = getShardedJedis();</span></span><br><span class="line">         Jedis sjedis = getJedis();</span><br><span class="line">         Set&lt;<span class="keyword">byte</span>[]&gt; set = sjedis.smembers(key);</span><br><span class="line">         sjedis.close();</span><br><span class="line">         <span class="keyword">return</span> set;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 将成员从源集合移出放入目标集合 &lt;br/&gt;</span></span><br><span class="line"><span class="comment">       * 如果源集合不存在或不包哈指定成员，不进行任何操作，返回0&lt;br/&gt;</span></span><br><span class="line"><span class="comment">       * 否则该成员从源集合上删除，并添加到目标集合，如果目标集合中成员已存在，则只在源集合进行删除</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            srckey 源集合</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            dstkey 目标集合</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            member 源集合中的成员</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 状态码，1成功，0失败</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">smove</span><span class="params">(String srckey, String dstkey, String member)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> s = jedis.smove(srckey, dstkey, member);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> s;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 从集合中删除成员</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 被删除的成员</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">spop</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         String s = jedis.spop(key);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> s;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 从集合中删除指定成员</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            member 要删除的成员</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 状态码，成功返回1，成员不存在返回0</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">srem</span><span class="params">(String key, String member)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> s = jedis.srem(key, member);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> s;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 合并多个集合并返回合并后的结果，合并后的结果集合并不保存&lt;br/&gt;</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            ... keys</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 合并后的结果集合</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@see</span> sunionstore</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">sunion</span><span class="params">(String... keys)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         Set&lt;String&gt; set = jedis.sunion(keys);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> set;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 合并多个集合并将合并后的结果集保存在指定的新集合中，如果新集合已经存在则覆盖</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            newkey 新集合的key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            ... keys 要合并的集合</span></span><br><span class="line"><span class="comment">       **/</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sunionstore</span><span class="params">(String newkey, String... keys)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> s = jedis.sunionstore(newkey, keys);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> s;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// *******************************************Hash*******************************************//</span></span><br><span class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hash</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 从hash中删除指定的存储</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            fieid 存储的名字</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 状态码，1成功，0失败</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">hdel</span><span class="params">(String key, String fieid)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> s = jedis.hdel(key, fieid);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> s;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">hdel</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> s = jedis.del(key);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> s;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 测试hash中指定的存储是否存在</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            fieid 存储的名字</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 1存在，0不存在</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hexists</span><span class="params">(String key, String fieid)</span> </span>&#123;</span><br><span class="line">         <span class="comment">// ShardedJedis sjedis = getShardedJedis();</span></span><br><span class="line">         Jedis sjedis = getJedis();</span><br><span class="line">         <span class="keyword">boolean</span> s = sjedis.hexists(key, fieid);</span><br><span class="line">         sjedis.close();</span><br><span class="line">         <span class="keyword">return</span> s;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 返回hash中指定存储位置的值</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            fieid 存储的名字</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 存储对应的值</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">hget</span><span class="params">(String key, String fieid)</span> </span>&#123;</span><br><span class="line">         <span class="comment">// ShardedJedis sjedis = getShardedJedis();</span></span><br><span class="line">         Jedis sjedis = getJedis();</span><br><span class="line">         String s = sjedis.hget(key, fieid);</span><br><span class="line">         sjedis.close();</span><br><span class="line">         <span class="keyword">return</span> s;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">byte</span>[] hget(<span class="keyword">byte</span>[] key, <span class="keyword">byte</span>[] fieid) &#123;</span><br><span class="line">         <span class="comment">// ShardedJedis sjedis = getShardedJedis();</span></span><br><span class="line">         Jedis sjedis = getJedis();</span><br><span class="line">         <span class="keyword">byte</span>[] s = sjedis.hget(key, fieid);</span><br><span class="line">         sjedis.close();</span><br><span class="line">         <span class="keyword">return</span> s;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 以Map的形式返回hash中的存储和值</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> Map&lt;Strinig,String&gt;</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">hgetAll</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">         <span class="comment">// ShardedJedis sjedis = getShardedJedis();</span></span><br><span class="line">         Jedis sjedis = getJedis();</span><br><span class="line">         Map&lt;String, String&gt; map = sjedis.hgetAll(key);</span><br><span class="line">         sjedis.close();</span><br><span class="line">         <span class="keyword">return</span> map;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 添加一个对应关系</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            fieid</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            value</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 状态码 1成功，0失败，fieid已存在将更新，也返回0</span></span><br><span class="line"><span class="comment">       **/</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">hset</span><span class="params">(String key, String fieid, String value)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> s = jedis.hset(key, fieid, value);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> s;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">hset</span><span class="params">(String key, String fieid, <span class="keyword">byte</span>[] value)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> s = jedis.hset(key.getBytes(), fieid.getBytes(), value);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> s;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 添加对应关系，只有在fieid不存在时才执行</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            fieid</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            value</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 状态码 1成功，0失败fieid已存</span></span><br><span class="line"><span class="comment">       **/</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">hsetnx</span><span class="params">(String key, String fieid, String value)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> s = jedis.hsetnx(key, fieid, value);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> s;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取hash中value的集合</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> List&lt;String&gt;</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">hvals</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">         <span class="comment">// ShardedJedis sjedis = getShardedJedis();</span></span><br><span class="line">         Jedis sjedis = getJedis();</span><br><span class="line">         List&lt;String&gt; list = sjedis.hvals(key);</span><br><span class="line">         sjedis.close();</span><br><span class="line">         <span class="keyword">return</span> list;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 在指定的存储位置加上指定的数字，存储位置的值必须可转为数字类型</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            fieid 存储位置</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            long value 要增加的值,可以是负数</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 增加指定数字后，存储位置的值</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">hincrby</span><span class="params">(String key, String fieid, <span class="keyword">long</span> value)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> s = jedis.hincrBy(key, fieid, value);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> s;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 返回指定hash中的所有存储名字,类似Map中的keySet方法</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> Set&lt;String&gt; 存储名称的集合</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">hkeys</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">         <span class="comment">// ShardedJedis sjedis = getShardedJedis();</span></span><br><span class="line">         Jedis sjedis = getJedis();</span><br><span class="line">         Set&lt;String&gt; set = sjedis.hkeys(key);</span><br><span class="line">         sjedis.close();</span><br><span class="line">         <span class="keyword">return</span> set;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取hash中存储的个数，类似Map中size方法</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> long 存储的个数</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">hlen</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">         <span class="comment">// ShardedJedis sjedis = getShardedJedis();</span></span><br><span class="line">         Jedis sjedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> len = sjedis.hlen(key);</span><br><span class="line">         sjedis.close();</span><br><span class="line">         <span class="keyword">return</span> len;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 根据多个key，获取对应的value，返回List,如果指定的key不存在,List对应位置为null</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            ... fieids 存储位置</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> List&lt;String&gt;</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">hmget</span><span class="params">(String key, String... fieids)</span> </span>&#123;</span><br><span class="line">         <span class="comment">// ShardedJedis sjedis = getShardedJedis();</span></span><br><span class="line">         Jedis sjedis = getJedis();</span><br><span class="line">         List&lt;String&gt; list = sjedis.hmget(key, fieids);</span><br><span class="line">         sjedis.close();</span><br><span class="line">         <span class="keyword">return</span> list;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">public</span> List&lt;<span class="keyword">byte</span>[]&gt; hmget(<span class="keyword">byte</span>[] key, <span class="keyword">byte</span>[]... fieids) &#123;</span><br><span class="line">         <span class="comment">// ShardedJedis sjedis = getShardedJedis();</span></span><br><span class="line">         Jedis sjedis = getJedis();</span><br><span class="line">         List&lt;<span class="keyword">byte</span>[]&gt; list = sjedis.hmget(key, fieids);</span><br><span class="line">         sjedis.close();</span><br><span class="line">         <span class="keyword">return</span> list;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 添加对应关系，如果对应关系已存在，则覆盖</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> Strin</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> Map</span></span><br><span class="line"><span class="comment">       *            &lt;String,String&gt; 对应关系</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 状态，成功返回OK</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">hmset</span><span class="params">(String key, Map&lt;String, String&gt; map)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         String s = jedis.hmset(key, map);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> s;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 添加对应关系，如果对应关系已存在，则覆盖</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> Strin</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> Map</span></span><br><span class="line"><span class="comment">       *            &lt;String,String&gt; 对应关系</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 状态，成功返回OK</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">hmset</span><span class="params">(<span class="keyword">byte</span>[] key, Map&lt;<span class="keyword">byte</span>[], <span class="keyword">byte</span>[]&gt; map)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         String s = jedis.hmset(key, map);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> s;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// *******************************************Lists*******************************************//</span></span><br><span class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Lists</span> </span>&#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * List长度</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 长度</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">llen</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> llen(SafeEncoder.encode(key));</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * List长度</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> byte[]</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 长度</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">llen</span><span class="params">(<span class="keyword">byte</span>[] key)</span> </span>&#123;</span><br><span class="line">         <span class="comment">// ShardedJedis sjedis = getShardedJedis();</span></span><br><span class="line">         Jedis sjedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> count = sjedis.llen(key);</span><br><span class="line">         sjedis.close();</span><br><span class="line">         <span class="keyword">return</span> count;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 覆盖操作,将覆盖List中指定位置的值</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> byte[]</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> int</span></span><br><span class="line"><span class="comment">       *            index 位置</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> byte[]</span></span><br><span class="line"><span class="comment">       *            value 值</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 状态码</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">lset</span><span class="params">(<span class="keyword">byte</span>[] key, <span class="keyword">int</span> index, <span class="keyword">byte</span>[] value)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         String status = jedis.lset(key, index, value);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> status;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 覆盖操作,将覆盖List中指定位置的值</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> int</span></span><br><span class="line"><span class="comment">       *            index 位置</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            value 值</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 状态码</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">lset</span><span class="params">(String key, <span class="keyword">int</span> index, String value)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> lset(SafeEncoder.encode(key), index, SafeEncoder.encode(value));</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 在value的相对位置插入记录</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> LIST_POSITION</span></span><br><span class="line"><span class="comment">       *            前面插入或后面插入</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            pivot 相对位置的内容</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            value 插入的内容</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 记录总数</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">linsert</span><span class="params">(String key, LIST_POSITION where, String pivot, String value)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> linsert(SafeEncoder.encode(key), where, SafeEncoder.encode(pivot), SafeEncoder.encode(value));</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 在指定位置插入记录</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> LIST_POSITION</span></span><br><span class="line"><span class="comment">       *            前面插入或后面插入</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> byte[]</span></span><br><span class="line"><span class="comment">       *            pivot 相对位置的内容</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> byte[]</span></span><br><span class="line"><span class="comment">       *            value 插入的内容</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 记录总数</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">linsert</span><span class="params">(<span class="keyword">byte</span>[] key, LIST_POSITION where, <span class="keyword">byte</span>[] pivot, <span class="keyword">byte</span>[] value)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> count = jedis.linsert(key, where, pivot, value);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> count;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取List中指定位置的值</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> int</span></span><br><span class="line"><span class="comment">       *            index 位置</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 值</span></span><br><span class="line"><span class="comment">       **/</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">lindex</span><span class="params">(String key, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> SafeEncoder.encode(lindex(SafeEncoder.encode(key), index));</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取List中指定位置的值</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> byte[]</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> int</span></span><br><span class="line"><span class="comment">       *            index 位置</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 值</span></span><br><span class="line"><span class="comment">       **/</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">byte</span>[] lindex(<span class="keyword">byte</span>[] key, <span class="keyword">int</span> index) &#123;</span><br><span class="line">         <span class="comment">// ShardedJedis sjedis = getShardedJedis();</span></span><br><span class="line">         Jedis sjedis = getJedis();</span><br><span class="line">         <span class="keyword">byte</span>[] value = sjedis.lindex(key, index);</span><br><span class="line">         sjedis.close();</span><br><span class="line">         <span class="keyword">return</span> value;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 将List中的第一条记录移出List</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 移出的记录</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">lpop</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> SafeEncoder.encode(lpop(SafeEncoder.encode(key)));</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 将List中的第一条记录移出List</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> byte[]</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 移出的记录</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">byte</span>[] lpop(<span class="keyword">byte</span>[] key) &#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">byte</span>[] value = jedis.lpop(key);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> value;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 将List中最后第一条记录移出List</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> byte[]</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 移出的记录</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">rpop</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         String value = jedis.rpop(key);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> value;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 向List尾部追加记录</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            value</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 记录总数</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">lpush</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> lpush(SafeEncoder.encode(key), SafeEncoder.encode(value));</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 向List头部追加记录</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            value</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 记录总数</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">rpush</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> count = jedis.rpush(key, value);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> count;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 向List头部追加记录</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            value</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 记录总数</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">rpush</span><span class="params">(<span class="keyword">byte</span>[] key, <span class="keyword">byte</span>[] value)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> count = jedis.rpush(key, value);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> count;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 向List中追加记录</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> byte[]</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> byte[]</span></span><br><span class="line"><span class="comment">       *            value</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 记录总数</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">lpush</span><span class="params">(<span class="keyword">byte</span>[] key, <span class="keyword">byte</span>[] value)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> count = jedis.lpush(key, value);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> count;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取指定范围的记录，可以做为分页使用</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> long</span></span><br><span class="line"><span class="comment">       *            start</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> long</span></span><br><span class="line"><span class="comment">       *            end</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> List</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">lrange</span><span class="params">(String key, <span class="keyword">long</span> start, <span class="keyword">long</span> end)</span> </span>&#123;</span><br><span class="line">         <span class="comment">// ShardedJedis sjedis = getShardedJedis();</span></span><br><span class="line">         Jedis sjedis = getJedis();</span><br><span class="line">         List&lt;String&gt; list = sjedis.lrange(key, start, end);</span><br><span class="line">         sjedis.close();</span><br><span class="line">         <span class="keyword">return</span> list;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取指定范围的记录，可以做为分页使用</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> byte[]</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> int</span></span><br><span class="line"><span class="comment">       *            start</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> int</span></span><br><span class="line"><span class="comment">       *            end 如果为负数，则尾部开始计算</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> List</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">public</span> List&lt;<span class="keyword">byte</span>[]&gt; lrange(<span class="keyword">byte</span>[] key, <span class="keyword">int</span> start, <span class="keyword">int</span> end) &#123;</span><br><span class="line">         <span class="comment">// ShardedJedis sjedis = getShardedJedis();</span></span><br><span class="line">         Jedis sjedis = getJedis();</span><br><span class="line">         List&lt;<span class="keyword">byte</span>[]&gt; list = sjedis.lrange(key, start, end);</span><br><span class="line">         sjedis.close();</span><br><span class="line">         <span class="keyword">return</span> list;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 删除List中c条记录，被删除的记录值为value</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> byte[]</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> int</span></span><br><span class="line"><span class="comment">       *            c 要删除的数量，如果为负数则从List的尾部检查并删除符合的记录</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> byte[]</span></span><br><span class="line"><span class="comment">       *            value 要匹配的值</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 删除后的List中的记录数</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">lrem</span><span class="params">(<span class="keyword">byte</span>[] key, <span class="keyword">int</span> c, <span class="keyword">byte</span>[] value)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         <span class="keyword">long</span> count = jedis.lrem(key, c, value);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> count;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 删除List中c条记录，被删除的记录值为value</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> int</span></span><br><span class="line"><span class="comment">       *            c 要删除的数量，如果为负数则从List的尾部检查并删除符合的记录</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            value 要匹配的值</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 删除后的List中的记录数</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">lrem</span><span class="params">(String key, <span class="keyword">int</span> c, String value)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> lrem(SafeEncoder.encode(key), c, SafeEncoder.encode(value));</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 算是删除吧，只保留start与end之间的记录</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> byte[]</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> int</span></span><br><span class="line"><span class="comment">       *            start 记录的开始位置(0表示第一条记录)</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> int</span></span><br><span class="line"><span class="comment">       *            end 记录的结束位置（如果为-1则表示最后一个，-2，-3以此类推）</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 执行状态码</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">ltrim</span><span class="params">(<span class="keyword">byte</span>[] key, <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">         Jedis jedis = getJedis();</span><br><span class="line">         String str = jedis.ltrim(key, start, end);</span><br><span class="line">         jedis.close();</span><br><span class="line">         <span class="keyword">return</span> str;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 算是删除吧，只保留start与end之间的记录</span></span><br><span class="line"><span class="comment">       * </span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> String</span></span><br><span class="line"><span class="comment">       *            key</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> int</span></span><br><span class="line"><span class="comment">       *            start 记录的开始位置(0表示第一条记录)</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param</span> int</span></span><br><span class="line"><span class="comment">       *            end 记录的结束位置（如果为-1则表示最后一个，-2，-3以此类推）</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@return</span> 执行状态码</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">ltrim</span><span class="params">(String key, <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> ltrim(SafeEncoder.encode(key), start, end);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="缓存编码实现"><a href="#缓存编码实现" class="headerlink" title="缓存编码实现"></a>缓存编码实现</h3><p>小试牛刀,将<strong>头条信息</strong>缓存</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">public interface HeadLineService &#123;</span><br><span class="line"></span><br><span class="line">    public static final String HLLISTKEY &#x3D; &quot;headlinelist&quot;;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据传入的条件返回指定的头条列表</span><br><span class="line">     *</span><br><span class="line">     * @param headLineCondition</span><br><span class="line">     * @return</span><br><span class="line">     * @throws IOException</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;HeadLine&gt; getHeadLineList(HeadLine headLineCondition);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 添加头条信息，并存储头条图片</span><br><span class="line">     *</span><br><span class="line">     * @param headLine</span><br><span class="line">     * @param thumbnail</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    HeadLineExecution addHeadLine(HeadLine headLine, ImageHolder thumbnail);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 修改头条信息</span><br><span class="line">     *</span><br><span class="line">     * @param headLine</span><br><span class="line">     * @param thumbnail</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    HeadLineExecution modifyHeadLine(HeadLine headLine, ImageHolder thumbnail);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 删除单条头条</span><br><span class="line">     *</span><br><span class="line">     * @param headLineId</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    HeadLineExecution removeHeadLine(long headLineId);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 批量删除头条</span><br><span class="line">     *</span><br><span class="line">     * @param headLineIdList</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    HeadLineExecution removeHeadLineList(List&lt;Long&gt; headLineIdList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeadLineServiceImpl</span> <span class="keyword">implements</span> <span class="title">HeadLineService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> HeadLineDao headLineDao;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JedisUtil.Keys jedisKeys;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JedisUtil.Strings jedisStrings;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(HeadLineServiceImpl<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;HeadLine&gt; <span class="title">getHeadLineList</span><span class="params">(HeadLine headLineCondition)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 定义redis的key前缀</span></span><br><span class="line">        String key = HLLISTKEY;</span><br><span class="line">        <span class="comment">// 定义接收对象</span></span><br><span class="line">        List&lt;HeadLine&gt; headLineList = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">// 定义jackson数据转换操作类</span></span><br><span class="line">        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        <span class="comment">// 拼接出redis的key</span></span><br><span class="line">        <span class="keyword">if</span> (headLineCondition != <span class="keyword">null</span> &amp;&amp; headLineCondition.getEnableStatus() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            key = key + <span class="string">"_"</span> + headLineCondition.getEnableStatus();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 判断key是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (!jedisKeys.exists(key)) &#123;</span><br><span class="line">            <span class="comment">// 若不存在，则从数据库里面取出相应数据</span></span><br><span class="line">            headLineList = headLineDao.queryHeadLine(headLineCondition);</span><br><span class="line">            <span class="comment">// 将相关的实体类集合转换成string,存入redis里面对应的key中</span></span><br><span class="line">            String jsonString;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                jsonString = mapper.writeValueAsString(headLineList);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                logger.error(e.getMessage());</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> HeadLineOperationException(e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">            jedisStrings.set(key, jsonString);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 若存在，则直接从redis里面取出相应数据</span></span><br><span class="line">            String jsonString = jedisStrings.get(key);</span><br><span class="line">            <span class="comment">// 指定要将string转换成的集合类型</span></span><br><span class="line">            JavaType javaType = mapper.getTypeFactory().constructParametricType(ArrayList<span class="class">.<span class="keyword">class</span>, <span class="title">HeadLine</span>.<span class="title">class</span>)</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 将相关key对应的value里的的string转换成对象的实体类集合</span></span><br><span class="line">                headLineList = mapper.readValue(jsonString, javaType);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (JsonParseException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                logger.error(e.getMessage());</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> HeadLineOperationException(e.getMessage());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (JsonMappingException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                logger.error(e.getMessage());</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> HeadLineOperationException(e.getMessage());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                logger.error(e.getMessage());</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> HeadLineOperationException(e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> headLineList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HeadLineExecution <span class="title">addHeadLine</span><span class="params">(HeadLine headLine, ImageHolder thumbnail)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 空值判断</span></span><br><span class="line">        <span class="keyword">if</span> (headLine != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 设定默认值</span></span><br><span class="line">            headLine.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">            headLine.setLastEditTime(<span class="keyword">new</span> Date());</span><br><span class="line">            <span class="comment">// 若传入的头条图片为非空，则存储图片并在实体类里将图片的相对路径设置上</span></span><br><span class="line">            <span class="keyword">if</span> (thumbnail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                addThumbnail(headLine, thumbnail);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 往数据库里插入头条信息</span></span><br><span class="line">                <span class="keyword">int</span> effectedNum = headLineDao.insertHeadLine(headLine);</span><br><span class="line">                <span class="keyword">if</span> (effectedNum &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    deleteRedis4HeadLine();</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> HeadLineExecution(HeadLineStateEnum.SUCCESS, headLine);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> HeadLineExecution(HeadLineStateEnum.INNER_ERROR);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> HeadLineOperationException(<span class="string">"添加区域信息失败:"</span> + e.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> HeadLineExecution(HeadLineStateEnum.EMPTY);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HeadLineExecution <span class="title">modifyHeadLine</span><span class="params">(HeadLine headLine, ImageHolder thumbnail)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 空值判断，主要是判断头条Id是否为空</span></span><br><span class="line">        <span class="keyword">if</span> (headLine.getLineId() != <span class="keyword">null</span> &amp;&amp; headLine.getLineId() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 设定默认值</span></span><br><span class="line">            headLine.setLastEditTime(<span class="keyword">new</span> Date());</span><br><span class="line">            <span class="keyword">if</span> (thumbnail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 若需要修改的图片流不为空，则需要处理现有的图片</span></span><br><span class="line">                HeadLine tempHeadLine = headLineDao.queryHeadLineById(headLine.getLineId());</span><br><span class="line">                <span class="keyword">if</span> (tempHeadLine.getLineImg() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// 若原来是存储有图片的，则将原先图片删除</span></span><br><span class="line">                    ImageUtil.deleteFileOrPath(tempHeadLine.getLineImg());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 添加新的图片，并将新的图片相对路径设置到实体类里</span></span><br><span class="line">                addThumbnail(headLine, thumbnail);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 更新头条信息</span></span><br><span class="line">                <span class="keyword">int</span> effectedNum = headLineDao.updateHeadLine(headLine);</span><br><span class="line">                <span class="keyword">if</span> (effectedNum &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    deleteRedis4HeadLine();</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> HeadLineExecution(HeadLineStateEnum.SUCCESS, headLine);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> HeadLineExecution(HeadLineStateEnum.INNER_ERROR);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> HeadLineOperationException(<span class="string">"更新头条信息失败:"</span> + e.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> HeadLineExecution(HeadLineStateEnum.EMPTY);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HeadLineExecution <span class="title">removeHeadLine</span><span class="params">(<span class="keyword">long</span> headLineId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 空值判断，主要判断头条Id是否为非空</span></span><br><span class="line">        <span class="keyword">if</span> (headLineId &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 根据Id查询头条信息</span></span><br><span class="line">                HeadLine tempHeadLine = headLineDao.queryHeadLineById(headLineId);</span><br><span class="line">                <span class="keyword">if</span> (tempHeadLine.getLineImg() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// 若头条原先存有图片，则将该图片文件删除</span></span><br><span class="line">                    ImageUtil.deleteFileOrPath(tempHeadLine.getLineImg());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 删除数据库里对应的头条信息</span></span><br><span class="line">                <span class="keyword">int</span> effectedNum = headLineDao.deleteHeadLine(headLineId);</span><br><span class="line">                <span class="keyword">if</span> (effectedNum &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    deleteRedis4HeadLine();</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> HeadLineExecution(HeadLineStateEnum.SUCCESS);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> HeadLineExecution(HeadLineStateEnum.INNER_ERROR);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> HeadLineOperationException(<span class="string">"删除头条信息失败:"</span> + e.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> HeadLineExecution(HeadLineStateEnum.EMPTY);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HeadLineExecution <span class="title">removeHeadLineList</span><span class="params">(List&lt;Long&gt; headLineIdList)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 空值判断</span></span><br><span class="line">        <span class="keyword">if</span> (headLineIdList != <span class="keyword">null</span> &amp;&amp; headLineIdList.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 根据传入的id列表获取头条列表</span></span><br><span class="line">                List&lt;HeadLine&gt; headLineList = headLineDao.queryHeadLineByIds(headLineIdList);</span><br><span class="line">                <span class="keyword">for</span> (HeadLine headLine : headLineList) &#123;</span><br><span class="line">                    <span class="comment">// 遍历头条列表，若头条的图片非空，则将图片删除</span></span><br><span class="line">                    <span class="keyword">if</span> (headLine.getLineImg() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        ImageUtil.deleteFileOrPath(headLine.getLineImg());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 批量删除数据库中的头条信息</span></span><br><span class="line">                <span class="keyword">int</span> effectedNum = headLineDao.batchDeleteHeadLine(headLineIdList);</span><br><span class="line">                <span class="keyword">if</span> (effectedNum &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    deleteRedis4HeadLine();</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> HeadLineExecution(HeadLineStateEnum.SUCCESS);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> HeadLineExecution(HeadLineStateEnum.INNER_ERROR);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> HeadLineOperationException(<span class="string">"删除头条信息失败:"</span> + e.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> HeadLineExecution(HeadLineStateEnum.EMPTY);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 存储图片</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headLine</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> thumbnail</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addThumbnail</span><span class="params">(HeadLine headLine, ImageHolder thumbnail)</span> </span>&#123;</span><br><span class="line">        String dest = PathUtil.getHeadLineImagePath();</span><br><span class="line">        String thumbnailAddr = ImageUtil.generateNormalImg(thumbnail, dest);</span><br><span class="line">        headLine.setLineImg(thumbnailAddr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 移除跟实体类相关的redis key-value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">deleteRedis4HeadLine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String prefix = HLLISTKEY;</span><br><span class="line">        <span class="comment">// 获取跟头条相关的redis key</span></span><br><span class="line">        Set&lt;String&gt; keySet = jedisKeys.keys(prefix + <span class="string">"*"</span>);</span><br><span class="line">        <span class="keyword">for</span> (String key : keySet) &#123;</span><br><span class="line">            <span class="comment">// 逐条删除</span></span><br><span class="line">            jedisKeys.del(key);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>缓存清除</p>
<p>依据key前缀删除匹配该模式下的所有key-value 如传入:shopcategory,则shopcategory_allfirstlevel等<br>以shopcategory打头的key_value都会被清空</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Service</span><br><span class="line">public class CacheServiceImpl implements CacheService &#123;</span><br><span class="line">   @Autowired</span><br><span class="line">   private JedisUtil.Keys jedisKeys;</span><br><span class="line"></span><br><span class="line">   @Override</span><br><span class="line">   public void removeFromCache(String keyPrefix) &#123;</span><br><span class="line">      Set&lt;String&gt; keySet &#x3D; jedisKeys.keys(keyPrefix + &quot;*&quot;);</span><br><span class="line">      for (String key : keySet) &#123;</span><br><span class="line">         jedisKeys.del(key);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="11-3-添加平台帐号体系"><a href="#11-3-添加平台帐号体系" class="headerlink" title="11-3 添加平台帐号体系"></a>11-3 添加平台帐号体系</h2><p>dao层：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PersonInfoDao</span> </span>&#123;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 根据查询条件分页返回用户信息列表</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> personInfoCondition</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> rowIndex</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> pageSize</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function">List&lt;PersonInfo&gt; <span class="title">queryPersonInfoList</span><span class="params">(@Param(<span class="string">"personInfoCondition"</span>)</span>PersonInfo personInfoCondition, @<span class="title">Param</span><span class="params">(<span class="string">"rowIndex"</span>)</span><span class="keyword">int</span> rowIndex, @<span class="title">Param</span><span class="params">(<span class="string">"pageSize"</span>)</span><span class="keyword">int</span> pageSize)</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 根据查询条件返回总数，配合queryPersonInfoList使用</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> personInfoCondition</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">int</span> <span class="title">queryPersonInfoCount</span><span class="params">(@Param(<span class="string">"personInfoCondition"</span>)</span>PersonInfo personInfoCondition)</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 通过用户Id查询用户</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function">PersonInfo <span class="title">queryPersonInfoById</span><span class="params">(<span class="keyword">long</span> userId)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 添加用户信息</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> personInfo</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">int</span> <span class="title">insertPersonInfo</span><span class="params">(PersonInfo personInfo)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 修改用户信息</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> personInfo</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">int</span> <span class="title">updatePersonInfo</span><span class="params">(PersonInfo personInfo)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">WechatAuthDao</span> </span>&#123;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 通过openId查询对应本平台的微信帐号</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> openId</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function">WechatAuth <span class="title">queryWechatInfoByOpenId</span><span class="params">(String openId)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 添加对应本平台的微信帐号</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> wechatAuth</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">int</span> <span class="title">insertWechatAuth</span><span class="params">(WechatAuth wechatAuth)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>service层：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PersonInfoService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 根据用户Id获取personInfo信息</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function">PersonInfo <span class="title">getPersonInfoById</span><span class="params">(Long userId)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 根据查询条件分页返回用户信息列表</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> personInfoCondition</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> pageIndex</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> pageSize</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function">PersonInfoExecution <span class="title">getPersonInfoList</span><span class="params">(PersonInfo personInfoCondition, <span class="keyword">int</span> pageIndex, <span class="keyword">int</span> pageSize)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 根据传入的PersonInfo修改对应的用户信息</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> pi</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function">PersonInfoExecution <span class="title">modifyPersonInfo</span><span class="params">(PersonInfo pi)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">WechatAuthService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 通过openId查找平台对应的微信帐号</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> openId</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function">WechatAuth <span class="title">getWechatAuthByOpenId</span><span class="params">(String openId)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 注册本平台的微信帐号</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> wechatAuth</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> profileImg</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> RuntimeException</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function">WechatAuthExecution <span class="title">register</span><span class="params">(WechatAuth wechatAuth)</span> <span class="keyword">throws</span> WechatAuthOperationException</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>controller层：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"wechat"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WechatController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Logger log = LoggerFactory.getLogger(WechatController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@RequestMapping</span>(method = &#123; RequestMethod.GET &#125;)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">		log.debug(<span class="string">"weixin get..."</span>);</span><br><span class="line">		<span class="comment">// 微信加密签名，signature结合了开发者填写的token参数和请求中的timestamp参数、nonce参数。</span></span><br><span class="line">		String signature = request.getParameter(<span class="string">"signature"</span>);</span><br><span class="line">		<span class="comment">// 时间戳</span></span><br><span class="line">		String timestamp = request.getParameter(<span class="string">"timestamp"</span>);</span><br><span class="line">		<span class="comment">// 随机数</span></span><br><span class="line">		String nonce = request.getParameter(<span class="string">"nonce"</span>);</span><br><span class="line">		<span class="comment">// 随机字符串</span></span><br><span class="line">		String echostr = request.getParameter(<span class="string">"echostr"</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 通过检验signature对请求进行校验，若校验成功则原样返回echostr，表示接入成功，否则接入失败</span></span><br><span class="line">		PrintWriter out = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			out = response.getWriter();</span><br><span class="line">			<span class="keyword">if</span> (SignUtil.checkSignature(signature, timestamp, nonce)) &#123;</span><br><span class="line">				log.debug(<span class="string">"weixin get success...."</span>);</span><br><span class="line">				out.print(echostr);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (out != <span class="keyword">null</span>)&#123;</span><br><span class="line">				out.close();</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"wechatlogin"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WechatLoginController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> Logger log = LoggerFactory.getLogger(WechatLoginController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String FRONTEND = <span class="string">"1"</span>;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SHOPEND = <span class="string">"2"</span>;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> PersonInfoService personInfoService;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> WechatAuthService wechatAuthService;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@RequestMapping</span>(value = <span class="string">"/logincheck"</span>, method = &#123; RequestMethod.GET &#125;)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">      log.debug(<span class="string">"weixin login get..."</span>);</span><br><span class="line">      <span class="comment">// 获取微信公众号传输过来的code,通过code可获取access_token,进而获取用户信息</span></span><br><span class="line">      String code = request.getParameter(<span class="string">"code"</span>);</span><br><span class="line">      <span class="comment">// 这个state可以用来传我们自定义的信息，方便程序调用，这里也可以不用</span></span><br><span class="line">      String roleType = request.getParameter(<span class="string">"state"</span>);</span><br><span class="line">      log.debug(<span class="string">"weixin login code:"</span> + code);</span><br><span class="line">      WechatUser user = <span class="keyword">null</span>;</span><br><span class="line">      String openId = <span class="keyword">null</span>;</span><br><span class="line">      WechatAuth auth = <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">null</span> != code) &#123;</span><br><span class="line">         UserAccessToken token;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 通过code获取access_token</span></span><br><span class="line">            token = WechatUtil.getUserAccessToken(code);</span><br><span class="line">            log.debug(<span class="string">"weixin login token:"</span> + token.toString());</span><br><span class="line">            <span class="comment">// 通过token获取accessToken</span></span><br><span class="line">            String accessToken = token.getAccessToken();</span><br><span class="line">            <span class="comment">// 通过token获取openId</span></span><br><span class="line">            openId = token.getOpenId();</span><br><span class="line">            <span class="comment">// 通过access_token和openId获取用户昵称等信息</span></span><br><span class="line">            user = WechatUtil.getUserInfo(accessToken, openId);</span><br><span class="line">            log.debug(<span class="string">"weixin login user:"</span> + user.toString());</span><br><span class="line">            request.getSession().setAttribute(<span class="string">"openId"</span>, openId);</span><br><span class="line">            auth = wechatAuthService.getWechatAuthByOpenId(openId);</span><br><span class="line">         &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">"error in getUserAccessToken or getUserInfo or findByOpenId: "</span> + e.toString());</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 若微信帐号为空则需要注册微信帐号，同时注册用户信息</span></span><br><span class="line">      <span class="keyword">if</span> (auth == <span class="keyword">null</span>) &#123;</span><br><span class="line">         PersonInfo personInfo = WechatUtil.getPersonInfoFromRequest(user);</span><br><span class="line">         auth = <span class="keyword">new</span> WechatAuth();</span><br><span class="line">         auth.setOpenId(openId);</span><br><span class="line">         <span class="keyword">if</span> (FRONTEND.equals(roleType)) &#123;</span><br><span class="line">            personInfo.setUserType(<span class="number">1</span>);</span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            personInfo.setUserType(<span class="number">2</span>);</span><br><span class="line">         &#125;</span><br><span class="line">         auth.setPersonInfo(personInfo);</span><br><span class="line">         WechatAuthExecution we = wechatAuthService.register(auth);</span><br><span class="line">         <span class="keyword">if</span> (we.getState() != WechatAuthStateEnum.SUCCESS.getState()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            personInfo = personInfoService.getPersonInfoById(auth.getPersonInfo().getUserId());</span><br><span class="line">            request.getSession().setAttribute(<span class="string">"user"</span>, personInfo);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         request.getSession().setAttribute(<span class="string">"user"</span>, auth.getPersonInfo());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 若用户点击的是前端展示系统按钮则进入前端展示系统</span></span><br><span class="line">      <span class="keyword">if</span> (FRONTEND.equals(roleType)) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"frontend/index"</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="string">"shop/shoplist"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="11-4-添加拦截器"><a href="#11-4-添加拦截器" class="headerlink" title="11-4 添加拦截器"></a>11-4 添加拦截器</h2><h2 id="11-5-定期备份数据的实现"><a href="#11-5-定期备份数据的实现" class="headerlink" title="11-5 定期备份数据的实现"></a>11-5 定期备份数据的实现</h2><blockquote>
<p><a href="https://www.jb51.net/article/107574.htm" target="_blank" rel="noopener">https://www.jb51.net/article/107574.htm</a></p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u账号 -p密码 数据库 &gt; /root/backup/sql/o2o 'date +%y%m%d%H%M%S'.sql</span><br></pre></td></tr></table></figure>

<p>另外使用crontab实现定时备份</p>
<h1 id="12-项目2-0设计"><a href="#12-项目2-0设计" class="headerlink" title="12 项目2.0设计"></a>12 项目2.0设计</h1><p> 12-1 项目2.0功能总览<br> 12-2 实体类及对应表的设计<br> 12-3 给商品增加积分字段及相应的程序改动</p>
<h1 id="13-框架大换血"><a href="#13-框架大换血" class="headerlink" title="13 框架大换血"></a>13 框架大换血</h1><p>项目框架由ssm迭代成SpringBoot</p>
<h2 id="13-1-SpringBoot的理论知识"><a href="#13-1-SpringBoot的理论知识" class="headerlink" title="13-1 SpringBoot的理论知识"></a>13-1 SpringBoot的理论知识</h2><h2 id="13-2-SpringBoot的搭建与启动"><a href="#13-2-SpringBoot的搭建与启动" class="headerlink" title="13-2 SpringBoot的搭建与启动"></a>13-2 SpringBoot的搭建与启动</h2><h2 id="13-3-pom的迁移"><a href="#13-3-pom的迁移" class="headerlink" title="13-3 pom的迁移"></a>13-3 pom的迁移</h2><h2 id="13-4-dao的迁移"><a href="#13-4-dao的迁移" class="headerlink" title="13-4 dao的迁移"></a>13-4 dao的迁移</h2><h2 id="13-6-service的迁移"><a href="#13-6-service的迁移" class="headerlink" title="13-6 service的迁移"></a>13-6 service的迁移</h2><h2 id="13-7-web层的迁移"><a href="#13-7-web层的迁移" class="headerlink" title="13-7 web层的迁移"></a>13-7 web层的迁移</h2><h2 id="13-8-前端页面的迁移"><a href="#13-8-前端页面的迁移" class="headerlink" title="13-8 前端页面的迁移"></a>13-8 前端页面的迁移</h2><h2 id="13-9-验证码的迁移"><a href="#13-9-验证码的迁移" class="headerlink" title="13-9 验证码的迁移"></a>13-9 验证码的迁移</h2><h2 id="13-10-替代docBase配置以实现图片的加载"><a href="#13-10-替代docBase配置以实现图片的加载" class="headerlink" title="13-10 替代docBase配置以实现图片的加载"></a>13-10 替代docBase配置以实现图片的加载</h2><h2 id="13-11-拦截器的迁移"><a href="#13-11-拦截器的迁移" class="headerlink" title="13-11 拦截器的迁移"></a>13-11 拦截器的迁移</h2><h2 id="13-12-PathUtil的改进"><a href="#13-12-PathUtil的改进" class="headerlink" title="13-12 PathUtil的改进"></a>13-12 PathUtil的改进</h2><h2 id="13-13-项目的打包与部署"><a href="#13-13-项目的打包与部署" class="headerlink" title="13-13 项目的打包与部署"></a>13-13 项目的打包与部署</h2><h1 id="14-店家管理系统增强"><a href="#14-店家管理系统增强" class="headerlink" title="14 店家管理系统增强"></a>14 店家管理系统增强</h1><h2 id="14-1-AwardDao的开发与测试"><a href="#14-1-AwardDao的开发与测试" class="headerlink" title="14-1 AwardDao的开发与测试"></a>14-1 AwardDao的开发与测试</h2><h2 id="14-2-UserAwardMapDao的开发与测试"><a href="#14-2-UserAwardMapDao的开发与测试" class="headerlink" title="14-2 UserAwardMapDao的开发与测试"></a>14-2 UserAwardMapDao的开发与测试</h2><h2 id="14-3-UserProductDao的开发与测试"><a href="#14-3-UserProductDao的开发与测试" class="headerlink" title="14-3 UserProductDao的开发与测试"></a>14-3 UserProductDao的开发与测试</h2><h2 id="14-4-ProductSellDailyDao的开发与测试"><a href="#14-4-ProductSellDailyDao的开发与测试" class="headerlink" title="14-4 ProductSellDailyDao的开发与测试"></a>14-4 ProductSellDailyDao的开发与测试</h2><h2 id="14-5-UserShopMapDao的开发与测试"><a href="#14-5-UserShopMapDao的开发与测试" class="headerlink" title="14-5 UserShopMapDao的开发与测试"></a>14-5 UserShopMapDao的开发与测试</h2><h2 id="14-6-ShopAuthMapDao的开发与测试"><a href="#14-6-ShopAuthMapDao的开发与测试" class="headerlink" title="14-6 ShopAuthMapDao的开发与测试"></a>14-6 ShopAuthMapDao的开发与测试</h2><h2 id="14-7-店铺授权之service层编码及最终效果展示"><a href="#14-7-店铺授权之service层编码及最终效果展示" class="headerlink" title="14-7 店铺授权之service层编码及最终效果展示"></a>14-7 店铺授权之service层编码及最终效果展示</h2><h2 id="14-8-店铺授权之二维码工具类的编写"><a href="#14-8-店铺授权之二维码工具类的编写" class="headerlink" title="14-8 店铺授权之二维码工具类的编写"></a>14-8 店铺授权之二维码工具类的编写</h2><h2 id="14-9-店铺授权之列表展示和授权修改的实现"><a href="#14-9-店铺授权之列表展示和授权修改的实现" class="headerlink" title="14-9 店铺授权之列表展示和授权修改的实现"></a>14-9 店铺授权之列表展示和授权修改的实现</h2><h2 id="14-10-店铺授权之访问微信获取用户信息的URL的剥离"><a href="#14-10-店铺授权之访问微信获取用户信息的URL的剥离" class="headerlink" title="14-10 店铺授权之访问微信获取用户信息的URL的剥离"></a>14-10 店铺授权之访问微信获取用户信息的URL的剥离</h2><h2 id="14-11-店铺授权之短链接的实现"><a href="#14-11-店铺授权之短链接的实现" class="headerlink" title="14-11 店铺授权之短链接的实现"></a>14-11 店铺授权之短链接的实现</h2><h2 id="14-12-店铺授权之授权二维码的生成"><a href="#14-12-店铺授权之授权二维码的生成" class="headerlink" title="14-12 店铺授权之授权二维码的生成"></a>14-12 店铺授权之授权二维码的生成</h2><h2 id="14-13-店铺授权之添加授权的编码实现"><a href="#14-13-店铺授权之添加授权的编码实现" class="headerlink" title="14-13 店铺授权之添加授权的编码实现"></a>14-13 店铺授权之添加授权的编码实现</h2><h2 id="14-14-店铺授权之部署以及远程调试"><a href="#14-14-店铺授权之部署以及远程调试" class="headerlink" title="14-14 店铺授权之部署以及远程调试"></a>14-14 店铺授权之部署以及远程调试</h2><h2 id="14-15-2-0框架升级"><a href="#14-15-2-0框架升级" class="headerlink" title="14-15 2.0框架升级"></a>14-15 2.0框架升级</h2><h2 id="14-16-添加统一异常处理模块-适合项目1-0和2-0"><a href="#14-16-添加统一异常处理模块-适合项目1-0和2-0" class="headerlink" title="14-16 添加统一异常处理模块(适合项目1.0和2.0)"></a>14-16 添加统一异常处理模块(适合项目1.0和2.0)</h2><h2 id="14-17-统一异常处理模块的验证"><a href="#14-17-统一异常处理模块的验证" class="headerlink" title="14-17 统一异常处理模块的验证"></a>14-17 统一异常处理模块的验证</h2><h1 id="15-前端展示系统增强和超级管理员模块"><a href="#15-前端展示系统增强和超级管理员模块" class="headerlink" title="15 前端展示系统增强和超级管理员模块"></a>15 前端展示系统增强和超级管理员模块</h1><h2 id="15-1-将Quartz引入到框架里"><a href="#15-1-将Quartz引入到框架里" class="headerlink" title="15-1 将Quartz引入到框架里"></a>15-1 将Quartz引入到框架里</h2><h2 id="15-2-定时统计店铺的商品日销量"><a href="#15-2-定时统计店铺的商品日销量" class="headerlink" title="15-2 定时统计店铺的商品日销量"></a>15-2 定时统计店铺的商品日销量</h2><h2 id="15-3-店铺销量基础service和controller的编写"><a href="#15-3-店铺销量基础service和controller的编写" class="headerlink" title="15-3 店铺销量基础service和controller的编写"></a>15-3 店铺销量基础service和controller的编写</h2><h2 id="15-4-店铺销量统计前端开发"><a href="#15-4-店铺销量统计前端开发" class="headerlink" title="15-4 店铺销量统计前端开发"></a>15-4 店铺销量统计前端开发</h2><h2 id="15-5-Echarts的动态化改"><a href="#15-5-Echarts的动态化改" class="headerlink" title="15-5 Echarts的动态化改"></a>15-5 Echarts的动态化改</h2><h2 id="15-6-Echarts的动态化验证"><a href="#15-6-Echarts的动态化验证" class="headerlink" title="15-6 Echarts的动态化验证"></a>15-6 Echarts的动态化验证</h2><h2 id="15-7-店家管理系统剩余功能开发之消费记录展示更改"><a href="#15-7-店家管理系统剩余功能开发之消费记录展示更改" class="headerlink" title="15-7 店家管理系统剩余功能开发之消费记录展示更改"></a>15-7 店家管理系统剩余功能开发之消费记录展示更改</h2><h2 id="15-8-前端展示系统补强之店铺详情页的修改"><a href="#15-8-前端展示系统补强之店铺详情页的修改" class="headerlink" title="15-8 前端展示系统补强之店铺详情页的修改"></a>15-8 前端展示系统补强之店铺详情页的修改</h2><h2 id="15-9-店家管理系统剩余功能开发之顾客积分页的开发"><a href="#15-9-店家管理系统剩余功能开发之顾客积分页的开发" class="headerlink" title="15-9 店家管理系统剩余功能开发之顾客积分页的开发"></a>15-9 店家管理系统剩余功能开发之顾客积分页的开发</h2><h2 id="15-10-店家管理系统剩余功能开发之奖品领取页的开发"><a href="#15-10-店家管理系统剩余功能开发之奖品领取页的开发" class="headerlink" title="15-10 店家管理系统剩余功能开发之奖品领取页的开发"></a>15-10 店家管理系统剩余功能开发之奖品领取页的开发</h2><h2 id="15-11-店家管理系统剩余功能开发之奖品管理页的开发"><a href="#15-11-店家管理系统剩余功能开发之奖品管理页的开发" class="headerlink" title="15-11 店家管理系统剩余功能开发之奖品管理页的开发"></a>15-11 店家管理系统剩余功能开发之奖品管理页的开发</h2><h2 id="15-12-店家管理系统剩余功能开发之奖品操作页的开发"><a href="#15-12-店家管理系统剩余功能开发之奖品操作页的开发" class="headerlink" title="15-12 店家管理系统剩余功能开发之奖品操作页的开发"></a>15-12 店家管理系统剩余功能开发之奖品操作页的开发</h2><h2 id="15-13-前端展示系统补强之店铺奖品列表页的开发"><a href="#15-13-前端展示系统补强之店铺奖品列表页的开发" class="headerlink" title="15-13 前端展示系统补强之店铺奖品列表页的开发"></a>15-13 前端展示系统补强之店铺奖品列表页的开发</h2><h2 id="15-14-前端展示系统补强之奖品兑换记录列表页的开发"><a href="#15-14-前端展示系统补强之奖品兑换记录列表页的开发" class="headerlink" title="15-14 前端展示系统补强之奖品兑换记录列表页的开发"></a>15-14 前端展示系统补强之奖品兑换记录列表页的开发</h2><h2 id="15-15-前端展示系统补强之消费记录二维码的生成以及消费记录的添加"><a href="#15-15-前端展示系统补强之消费记录二维码的生成以及消费记录的添加" class="headerlink" title="15-15 前端展示系统补强之消费记录二维码的生成以及消费记录的添加"></a>15-15 前端展示系统补强之消费记录二维码的生成以及消费记录的添加</h2><h2 id="15-16-前端展示系统补强之奖品兑换记录详情页的开发"><a href="#15-16-前端展示系统补强之奖品兑换记录详情页的开发" class="headerlink" title="15-16 前端展示系统补强之奖品兑换记录详情页的开发"></a>15-16 前端展示系统补强之奖品兑换记录详情页的开发</h2><h2 id="15-17-前端展示系统补强之消费记录列表页的开发"><a href="#15-17-前端展示系统补强之消费记录列表页的开发" class="headerlink" title="15-17 前端展示系统补强之消费记录列表页的开发"></a>15-17 前端展示系统补强之消费记录列表页的开发</h2><h2 id="15-18-前端展示系统补强之顾客各店铺积分列表页的开发"><a href="#15-18-前端展示系统补强之顾客各店铺积分列表页的开发" class="headerlink" title="15-18 前端展示系统补强之顾客各店铺积分列表页的开发"></a>15-18 前端展示系统补强之顾客各店铺积分列表页的开发</h2><h2 id="15-19-前端展示系统补强之奖品详情页的开发"><a href="#15-19-前端展示系统补强之奖品详情页的开发" class="headerlink" title="15-19 前端展示系统补强之奖品详情页的开发"></a>15-19 前端展示系统补强之奖品详情页的开发</h2><h2 id="15-20-超级管理员系统提点"><a href="#15-20-超级管理员系统提点" class="headerlink" title="15-20 超级管理员系统提点"></a>15-20 超级管理员系统提点</h2>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%A0%A1%E5%9B%AD%E5%95%86%E9%93%BA%E7%B3%BB%E7%BB%9F/" rel="tag"><i class="fa fa-tag"></i> 校园商铺系统</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/02/13/server-xml%E4%B8%ADdocBase%E5%92%8Cpath%E7%9A%84%E5%85%B3%E7%B3%BB%E6%A2%B3%E7%90%86/" rel="prev" title="server.xml中docBase和path的关系梳理">
      <i class="fa fa-chevron-left"></i> server.xml中docBase和path的关系梳理
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/07/15/git%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF/" rel="next" title="git常见错误">
      git常见错误 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-开发准备"><span class="nav-text">1 开发准备</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-项目设计和框架搭建"><span class="nav-text">2 项目设计和框架搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-系统功能模块划分"><span class="nav-text">2-1 系统功能模块划分</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-实体类设计与表创建"><span class="nav-text">2-2 实体类设计与表创建</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-配置Maven"><span class="nav-text">2-3 配置Maven</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-逐层完成SSM的各项配置"><span class="nav-text">2-4 逐层完成SSM的各项配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-5-升级mysql驱动相关的配置以支持mysql8"><span class="nav-text">2-5 升级mysql驱动相关的配置以支持mysql8</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-6-验证Sevice与Controller"><span class="nav-text">2-6 验证Sevice与Controller</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-Logback配置与使用"><span class="nav-text">3 Logback配置与使用</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-店铺注册功能模块"><span class="nav-text">4 店铺注册功能模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-Dao层之新增店铺"><span class="nav-text">4-1 Dao层之新增店铺</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-Dao层之更新店铺"><span class="nav-text">4-2 Dao层之更新店铺</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-Thumbnailator图片处理和封装Util"><span class="nav-text">4-3 Thumbnailator图片处理和封装Util</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-4-Dto之ShopExecution的实现"><span class="nav-text">4-4 Dto之ShopExecution的实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-5-店铺注册之Service层的实现"><span class="nav-text">4-5 店铺注册之Service层的实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-6-店铺注册功能之Controller层的实现与改造"><span class="nav-text">4-6 店铺注册功能之Controller层的实现与改造</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-7-店铺注册之前端设计"><span class="nav-text">4-7 店铺注册之前端设计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-8-店铺注册之js实现"><span class="nav-text">4-8 店铺注册之js实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-9-店铺类别区域信息的获取"><span class="nav-text">4-9 店铺类别区域信息的获取</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-10-引入kaptcha实现验证码"><span class="nav-text">4-10 引入kaptcha实现验证码</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-主从库同步与读写分离"><span class="nav-text">5 主从库同步与读写分离</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-店铺编辑和列表功能"><span class="nav-text">6 店铺编辑和列表功能</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-商品类别模块"><span class="nav-text">7 商品类别模块</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-商品模块"><span class="nav-text">8 商品模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#8-1-商品添加之Dao层的实现"><span class="nav-text">8-1 商品添加之Dao层的实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-2-商品添加之Service层的实现"><span class="nav-text">8-2 商品添加之Service层的实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-3-商品添加之Controller层的实现"><span class="nav-text">8-3 商品添加之Controller层的实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-4-商品添加之前端"><span class="nav-text">8-4 商品添加之前端</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-5-商品编辑之后端开发"><span class="nav-text">8-5 商品编辑之后端开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-6-商品编辑之前端实现"><span class="nav-text">8-6 商品编辑之前端实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-7-商品列表展示之后端开发"><span class="nav-text">8-7 商品列表展示之后端开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-8-商品列表展示之前端开发"><span class="nav-text">8-8 商品列表展示之前端开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-9-解除商品与某商品类别的关联的实现"><span class="nav-text">8-9 解除商品与某商品类别的关联的实现</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-前端展示系统"><span class="nav-text">9 前端展示系统</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#9-1-首页后台的开发"><span class="nav-text">9-1 首页后台的开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-2-首页前端的开发"><span class="nav-text">9-2 首页前端的开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-3-docBase与upload的含义"><span class="nav-text">9-3 docBase与upload的含义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-4-店铺列表页后端的开发"><span class="nav-text">9-4 店铺列表页后端的开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-5-店铺列表页前端的开发"><span class="nav-text">9-5 店铺列表页前端的开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-6-店铺详情页的开发"><span class="nav-text">9-6 店铺详情页的开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-7-商品详情页的开发"><span class="nav-text">9-7 商品详情页的开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-8-前端展示系统bug修复"><span class="nav-text">9-8 前端展示系统bug修复</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10-阿里云部署及远程微信开发调试心得与技巧"><span class="nav-text">10 阿里云部署及远程微信开发调试心得与技巧</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#10-1-阿里云初始化与执行环境安装"><span class="nav-text">10-1 阿里云初始化与执行环境安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-2-项目打包发布与域名解析"><span class="nav-text">10-2 项目打包发布与域名解析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-3-微信测试号的申请与连接"><span class="nav-text">10-3 微信测试号的申请与连接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-4-微信登录帐号的创建"><span class="nav-text">10-4 微信登录帐号的创建</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#11-项目优化"><span class="nav-text">11 项目优化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#11-1-对关键配置信息进行DES加密"><span class="nav-text">11-1 对关键配置信息进行DES加密</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-2-引入缓存技术Redis"><span class="nav-text">11-2 引入缓存技术Redis</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis配置"><span class="nav-text">Redis配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#缓存操作封装"><span class="nav-text">缓存操作封装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#缓存编码实现"><span class="nav-text">缓存编码实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-3-添加平台帐号体系"><span class="nav-text">11-3 添加平台帐号体系</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-4-添加拦截器"><span class="nav-text">11-4 添加拦截器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-5-定期备份数据的实现"><span class="nav-text">11-5 定期备份数据的实现</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#12-项目2-0设计"><span class="nav-text">12 项目2.0设计</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#13-框架大换血"><span class="nav-text">13 框架大换血</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#13-1-SpringBoot的理论知识"><span class="nav-text">13-1 SpringBoot的理论知识</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-2-SpringBoot的搭建与启动"><span class="nav-text">13-2 SpringBoot的搭建与启动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-3-pom的迁移"><span class="nav-text">13-3 pom的迁移</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-4-dao的迁移"><span class="nav-text">13-4 dao的迁移</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-6-service的迁移"><span class="nav-text">13-6 service的迁移</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-7-web层的迁移"><span class="nav-text">13-7 web层的迁移</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-8-前端页面的迁移"><span class="nav-text">13-8 前端页面的迁移</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-9-验证码的迁移"><span class="nav-text">13-9 验证码的迁移</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-10-替代docBase配置以实现图片的加载"><span class="nav-text">13-10 替代docBase配置以实现图片的加载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-11-拦截器的迁移"><span class="nav-text">13-11 拦截器的迁移</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-12-PathUtil的改进"><span class="nav-text">13-12 PathUtil的改进</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-13-项目的打包与部署"><span class="nav-text">13-13 项目的打包与部署</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#14-店家管理系统增强"><span class="nav-text">14 店家管理系统增强</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#14-1-AwardDao的开发与测试"><span class="nav-text">14-1 AwardDao的开发与测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-2-UserAwardMapDao的开发与测试"><span class="nav-text">14-2 UserAwardMapDao的开发与测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-3-UserProductDao的开发与测试"><span class="nav-text">14-3 UserProductDao的开发与测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-4-ProductSellDailyDao的开发与测试"><span class="nav-text">14-4 ProductSellDailyDao的开发与测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-5-UserShopMapDao的开发与测试"><span class="nav-text">14-5 UserShopMapDao的开发与测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-6-ShopAuthMapDao的开发与测试"><span class="nav-text">14-6 ShopAuthMapDao的开发与测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-7-店铺授权之service层编码及最终效果展示"><span class="nav-text">14-7 店铺授权之service层编码及最终效果展示</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-8-店铺授权之二维码工具类的编写"><span class="nav-text">14-8 店铺授权之二维码工具类的编写</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-9-店铺授权之列表展示和授权修改的实现"><span class="nav-text">14-9 店铺授权之列表展示和授权修改的实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-10-店铺授权之访问微信获取用户信息的URL的剥离"><span class="nav-text">14-10 店铺授权之访问微信获取用户信息的URL的剥离</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-11-店铺授权之短链接的实现"><span class="nav-text">14-11 店铺授权之短链接的实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-12-店铺授权之授权二维码的生成"><span class="nav-text">14-12 店铺授权之授权二维码的生成</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-13-店铺授权之添加授权的编码实现"><span class="nav-text">14-13 店铺授权之添加授权的编码实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-14-店铺授权之部署以及远程调试"><span class="nav-text">14-14 店铺授权之部署以及远程调试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-15-2-0框架升级"><span class="nav-text">14-15 2.0框架升级</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-16-添加统一异常处理模块-适合项目1-0和2-0"><span class="nav-text">14-16 添加统一异常处理模块(适合项目1.0和2.0)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-17-统一异常处理模块的验证"><span class="nav-text">14-17 统一异常处理模块的验证</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#15-前端展示系统增强和超级管理员模块"><span class="nav-text">15 前端展示系统增强和超级管理员模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#15-1-将Quartz引入到框架里"><span class="nav-text">15-1 将Quartz引入到框架里</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-2-定时统计店铺的商品日销量"><span class="nav-text">15-2 定时统计店铺的商品日销量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-3-店铺销量基础service和controller的编写"><span class="nav-text">15-3 店铺销量基础service和controller的编写</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-4-店铺销量统计前端开发"><span class="nav-text">15-4 店铺销量统计前端开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-5-Echarts的动态化改"><span class="nav-text">15-5 Echarts的动态化改</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-6-Echarts的动态化验证"><span class="nav-text">15-6 Echarts的动态化验证</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-7-店家管理系统剩余功能开发之消费记录展示更改"><span class="nav-text">15-7 店家管理系统剩余功能开发之消费记录展示更改</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-8-前端展示系统补强之店铺详情页的修改"><span class="nav-text">15-8 前端展示系统补强之店铺详情页的修改</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-9-店家管理系统剩余功能开发之顾客积分页的开发"><span class="nav-text">15-9 店家管理系统剩余功能开发之顾客积分页的开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-10-店家管理系统剩余功能开发之奖品领取页的开发"><span class="nav-text">15-10 店家管理系统剩余功能开发之奖品领取页的开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-11-店家管理系统剩余功能开发之奖品管理页的开发"><span class="nav-text">15-11 店家管理系统剩余功能开发之奖品管理页的开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-12-店家管理系统剩余功能开发之奖品操作页的开发"><span class="nav-text">15-12 店家管理系统剩余功能开发之奖品操作页的开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-13-前端展示系统补强之店铺奖品列表页的开发"><span class="nav-text">15-13 前端展示系统补强之店铺奖品列表页的开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-14-前端展示系统补强之奖品兑换记录列表页的开发"><span class="nav-text">15-14 前端展示系统补强之奖品兑换记录列表页的开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-15-前端展示系统补强之消费记录二维码的生成以及消费记录的添加"><span class="nav-text">15-15 前端展示系统补强之消费记录二维码的生成以及消费记录的添加</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-16-前端展示系统补强之奖品兑换记录详情页的开发"><span class="nav-text">15-16 前端展示系统补强之奖品兑换记录详情页的开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-17-前端展示系统补强之消费记录列表页的开发"><span class="nav-text">15-17 前端展示系统补强之消费记录列表页的开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-18-前端展示系统补强之顾客各店铺积分列表页的开发"><span class="nav-text">15-18 前端展示系统补强之顾客各店铺积分列表页的开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-19-前端展示系统补强之奖品详情页的开发"><span class="nav-text">15-19 前端展示系统补强之奖品详情页的开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-20-超级管理员系统提点"><span class="nav-text">15-20 超级管理员系统提点</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="liubin"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">liubin</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">104</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">65</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">96</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/liuurick" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;liuurick" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:liuurick@gmail.com" title="E-Mail → mailto:liuurick@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/liuurick" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;liuurick" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://instagram.com/liuurick" title="Instagram → https:&#x2F;&#x2F;instagram.com&#x2F;liuurick" rel="noopener" target="_blank"><i class="fab fa-instagram fa-fw"></i>Instagram</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">liubin</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
